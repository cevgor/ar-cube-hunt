<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–•—Ä–æ–Ω–∏–∫–∏ –ø–∞–¥–∞—é—â–∏—Ö –∑–≤—ë–∑–¥ | –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            background: #000;
            color: #0ff;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        #gameContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        #ui {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 5, 15, 0.9);
            z-index: 20;
        }
        
        .hidden {
            display: none;
        }
        
        .hud {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 14px;
            text-shadow: 0 0 5px #0ff;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            border: 1px solid #0ff;
            border-radius: 5px;
        }
        
        .resources {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 14px;
            text-shadow: 0 0 5px #0ff;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            border: 1px solid #0ff;
            border-radius: 5px;
            text-align: right;
        }
        
        /* –ü—Ä–æ—Å—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - 3 –∫–Ω–æ–ø–∫–∏ */
        .simple-controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 30px;
            pointer-events: auto;
        }
        
        .control-btn {
            width: 80px;
            height: 80px;
            border-radius: 15px;
            background: rgba(0, 255, 255, 0.3);
            border: 3px solid #0ff;
            color: #0ff;
            font-size: 28px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 0 20px #0ff;
            touch-action: manipulation;
            transition: all 0.1s;
        }
        
        .control-btn:active {
            background: rgba(0, 255, 255, 0.6);
            transform: scale(0.95);
        }
        
        .btn {
            background: transparent;
            color: #0ff;
            border: 2px solid #0ff;
            padding: 12px 25px;
            margin: 10px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.3s;
            border-radius: 5px;
        }
        
        .btn:active {
            background: rgba(0, 255, 255, 0.2);
        }
        
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0) 0%,
                rgba(255,255,255,0.03) 50%,
                rgba(255,255,255,0) 100%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 5;
        }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            text-align: center;
            z-index: 100;
        }
        
        .planet-interface {
            background: rgba(0, 10, 30, 0.95);
            padding: 30px;
            border: 3px solid #0ff;
            border-radius: 15px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }
        
        .dialogue {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #0ff;
            border-radius: 10px;
            background: rgba(0, 20, 40, 0.7);
        }
        
        .trader-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .trader-option {
            padding: 10px;
            border: 1px solid #0ff;
            border-radius: 5px;
            background: rgba(0, 30, 60, 0.7);
            cursor: pointer;
            text-align: center;
            pointer-events: auto;
        }
        
        .trader-option:active {
            background: rgba(0, 50, 100, 0.7);
        }
        
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-height: 600px) {
            .hud, .resources {
                font-size: 12px;
                padding: 5px;
            }
            
            .control-btn {
                width: 70px;
                height: 70px;
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</div>
    <div id="gameContainer"></div>
    <div id="ui">
        <div class="scanlines"></div>
        
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="menuScreen" class="screen">
            <h1>–•–†–û–ù–ò–ö–ò –ü–ê–î–ê–Æ–©–ò–• –ó–í–Å–ó–î</h1>
            <p style="margin-bottom: 30px; text-align: center;">–ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ</p>
            <button class="btn" id="startBtn">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
        </div>
        
        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div id="gameScreen" class="screen hidden">
            <div class="hud">
                <div>‚ù§Ô∏è: <span id="healthValue">100</span>%</div>
                <div>üöÄ: <span id="speedValue">0</span></div>
                <div>üõ°Ô∏è: <span id="shieldValue">100</span>%</div>
            </div>
            
            <div class="resources">
                <div>‚≠ê: <span id="starsValue">0</span></div>
                <div>üîß: <span id="fragmentsValue">0</span></div>
                <div>üèÜ: <span id="scoreValue">0</span></div>
            </div>
            
            <div class="simple-controls">
                <div class="control-btn" id="leftBtn">‚Üê</div>
                <div class="control-btn" id="forwardBtn">‚Üë</div>
                <div class="control-btn" id="rightBtn">‚Üí</div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –ø–ª–∞–Ω–µ—Ç—ã -->
        <div id="planetScreen" class="screen hidden">
            <div class="planet-interface">
                <h2 id="planetName">–ü–õ–ê–ù–ï–¢–ê</h2>
                <div class="dialogue" id="planetDialogue">
                    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –ø–ª–∞–Ω–µ—Ç—É! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?
                </div>
                
                <div class="trader-options">
                    <div class="trader-option" data-action="trade">–¢–û–†–ì–û–í–ê–¢–¨</div>
                    <div class="trader-option" data-action="talk">–ü–û–ë–û–õ–¢–ê–¢–¨</div>
                    <div class="trader-option" data-action="repair">–ü–û–ß–ò–ù–ò–¢–¨ –ö–û–†–ê–ë–õ–¨</div>
                    <div class="trader-option" data-action="upgrade">–£–õ–£–ß–®–ï–ù–ò–Ø</div>
                    <div class="trader-option" data-action="mission">–ü–û–õ–£–ß–ò–¢–¨ –ó–ê–î–ê–ù–ò–ï</div>
                    <div class="trader-option" data-action="leave">–£–õ–ï–¢–ï–¢–¨</div>
                </div>
                
                <div id="tradeInterface" style="display: none; margin-top: 20px;">
                    <h3>–¢–û–†–ì–û–í–õ–Ø</h3>
                    <div class="trader-options">
                        <div class="trader-option" data-trade="buyStars">–ö–£–ü–ò–¢–¨ –ó–í–Å–ó–î–´ (10üîß –∑–∞ 1‚≠ê)</div>
                        <div class="trader-option" data-trade="sellStars">–ü–†–û–î–ê–¢–¨ –ó–í–Å–ó–î–´ (1‚≠ê –∑–∞ 8üîß)</div>
                        <div class="trader-option" data-trade="buyShield">–ö–£–ü–ò–¢–¨ –©–ò–¢ (50üîß)</div>
                        <div class="trader-option" data-trade="back">–ù–ê–ó–ê–î</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã -->
        <div id="gameOver" class="screen hidden">
            <div style="background: rgba(0, 0, 0, 0.9); padding: 30px; border: 2px solid #f00; text-align: center; border-radius: 10px;">
                <h2>–ö–û–†–ê–ë–õ–¨ –£–ù–ò–ß–¢–û–ñ–ï–ù</h2>
                <p style="margin: 20px 0; font-size: 18px;">–°—á—ë—Ç: <span id="finalScore">0</span></p>
                <button class="btn" id="restartBtn">–ù–û–í–ê–Ø –ò–ì–†–ê</button>
                <button class="btn" id="menuBtn">–ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</button>
            </div>
        </div>
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É Three.js
        if (typeof THREE === 'undefined') {
            document.getElementById('loading').innerHTML = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Three.js. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.';
            throw new Error('Three.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        }

        let scene, camera, renderer, ship;
        let asteroids = [], enemyShips = [], starFields = [], planets = [], crystals = [];
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameState = {
            health: 100,
            stars: 0,
            fragments: 0,
            score: 0,
            speed: 0.5, // –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –≤–ø–µ—Ä–µ–¥
            rotationSpeed: 0.05,
            isShieldActive: false,
            shieldEnergy: 100,
            gameActive: false,
            touchControls: {
                left: false,
                right: false,
                forward: false
            },
            currentPlanet: null
        };

        // –ü–ª–∞–Ω–µ—Ç—ã –∏ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏—è
        const planetData = [
            { 
                name: "–ö–†–ò–û–ù–ò–°", 
                dialogue: "–õ–µ–¥—è–Ω–∞—è –ø–ª–∞–Ω–µ—Ç–∞. –ú–µ—Å—Ç–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—Ü—ã –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç —Ä–µ–¥–∫–∏–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã.",
                trader: { name: "–¢–æ—Ä–≥–æ–≤–µ—Ü –ì–ª–æ—Ä–±", mood: "–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π" }
            },
            { 
                name: "–ü–ò–†–û–°", 
                dialogue: "–û–≥–Ω–µ–Ω–Ω—ã–π –º–∏—Ä. –û–ø–∞—Å–Ω–æ, –Ω–æ –±–æ–≥–∞—Ç —Ä–µ—Å—É—Ä—Å–∞–º–∏.",
                trader: { name: "–®–∞—Ö—Ç—ë—Ä –ë—Ä–∞–∫", mood: "–≥—Ä—É–±—ã–π" }
            },
            { 
                name: "–í–ï–†–î–ê–ù–¢", 
                dialogue: "–ó–µ–ª—ë–Ω–∞—è –ø–ª–∞–Ω–µ—Ç–∞ —Å –¥—Ä–µ–≤–Ω–∏–º–∏ —Ä—É–∏–Ω–∞–º–∏.",
                trader: { name: "–ê—Ä—Ö–µ–æ–ª–æ–≥ –ó–∞—Ä–∞", mood: "—É—á—ë–Ω—ã–π" }
            },
            { 
                name: "–ù–ï–ö–°–£–°", 
                dialogue: "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è, —Ü–µ–Ω—Ç—Ä —Ç–æ—Ä–≥–æ–≤–ª–∏ —Å–µ–∫—Ç–æ—Ä–∞.",
                trader: { name: "–ú–µ—Ächant AI", mood: "–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π" }
            }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Three.js
        function initThreeJS() {
            try {
                // –°—Ü–µ–Ω–∞
                scene = new THREE.Scene();
                
                // –ö–∞–º–µ—Ä–∞
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
                
                // –†–µ–Ω–¥–µ—Ä–µ—Ä
                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x000011, 1);
                document.getElementById('gameContainer').appendChild(renderer.domElement);
                
                // –û—Å–≤–µ—â–µ–Ω–∏–µ
                const ambientLight = new THREE.AmbientLight(0x333355);
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(1, 1, 1);
                scene.add(directionalLight);
                
                // –ó–≤—ë–∑–¥–Ω–æ–µ –Ω–µ–±–æ
                createStarfield();
                
                // –ö–æ—Ä–∞–±–ª—å –∏–≥—Ä–æ–∫–∞
                createShip();
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                document.getElementById('loading').style.display = 'none';
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Three.js:', error);
                document.getElementById('loading').innerHTML = '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ 3D. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É WebGL.';
                return false;
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤—ë–∑–¥–Ω–æ–≥–æ –Ω–µ–±–∞
        function createStarfield() {
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 2000;
            const starPositions = new Float32Array(starCount * 3);
            
            for (let i = 0; i < starCount * 3; i += 3) {
                starPositions[i] = (Math.random() - 0.5) * 2000;
                starPositions[i + 1] = (Math.random() - 0.5) * 2000;
                starPositions[i + 2] = (Math.random() - 0.5) * 2000;
            }
            
            starGeometry.setAttribute('position', new THREE.BufferAttribute(starPositions, 3));
            
            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 1.5,
                sizeAttenuation: true
            });
            
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è
        function createShip() {
            const shipGeometry = new THREE.ConeGeometry(3, 10, 4);
            const shipMaterial = new THREE.MeshPhongMaterial({
                color: 0x00aaff,
                shininess: 100,
                emissive: 0x002266
            });
            
            ship = new THREE.Mesh(shipGeometry, shipMaterial);
            ship.rotation.x = Math.PI / 2;
            ship.position.z = 15;
            scene.add(ship);
        }
        
        // –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤
        function generateAsteroids(count) {
            for (let i = 0; i < count; i++) {
                const size = Math.random() * 5 + 1;
                const geometry = new THREE.IcosahedronGeometry(size, 0);
                const material = new THREE.MeshPhongMaterial({
                    color: 0x888888,
                    shininess: 30
                });
                
                const asteroid = new THREE.Mesh(geometry, material);
                
                asteroid.position.x = (Math.random() - 0.5) * 200;
                asteroid.position.y = (Math.random() - 0.5) * 200;
                asteroid.position.z = -100 - Math.random() * 500;
                
                asteroid.rotation.x = Math.random() * Math.PI;
                asteroid.rotation.y = Math.random() * Math.PI;
                
                asteroid.userData = {
                    rotationSpeed: {
                        x: (Math.random() - 0.5) * 0.02,
                        y: (Math.random() - 0.5) * 0.02,
                        z: (Math.random() - 0.5) * 0.02
                    }
                };
                
                scene.add(asteroid);
                asteroids.push(asteroid);
            }
        }
        
        // –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–∞–∂–µ—Å–∫–∏—Ö –∫–æ—Ä–∞–±–ª–µ–π
        function generateEnemyShips(count) {
            for (let i = 0; i < count; i++) {
                const geometry = new THREE.OctahedronGeometry(3, 0);
                const material = new THREE.MeshPhongMaterial({
                    color: 0xff3300,
                    shininess: 100,
                    emissive: 0x330000
                });
                
                const enemyShip = new THREE.Mesh(geometry, material);
                
                enemyShip.position.x = (Math.random() - 0.5) * 150;
                enemyShip.position.y = (Math.random() - 0.5) * 150;
                enemyShip.position.z = -200 - Math.random() * 400;
                
                enemyShip.userData = {
                    health: 30
                };
                
                scene.add(enemyShip);
                enemyShips.push(enemyShip);
            }
        }
        
        // –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –∑–≤—ë–∑–¥ (—Ä–µ—Å—É—Ä—Å—ã)
        function generateStarFields(count) {
            for (let i = 0; i < count; i++) {
                const geometry = new THREE.SphereGeometry(2, 8, 8);
                const material = new THREE.MeshPhongMaterial({
                    color: 0xffff00,
                    shininess: 100,
                    emissive: 0x444400
                });
                
                const starField = new THREE.Mesh(geometry, material);
                
                starField.position.x = (Math.random() - 0.5) * 180;
                starField.position.y = (Math.random() - 0.5) * 180;
                starField.position.z = -150 - Math.random() * 450;
                
                starField.userData = {
                    rotationSpeed: (Math.random() - 0.5) * 0.05,
                    collected: false
                };
                
                scene.add(starField);
                starFields.push(starField);
            }
        }
        
        // –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤
        function generateCrystals(count) {
            for (let i = 0; i < count; i++) {
                const geometry = new THREE.OctahedronGeometry(1.5, 0);
                const material = new THREE.MeshPhongMaterial({
                    color: 0xff00ff,
                    shininess: 100,
                    emissive: 0x330033
                });
                
                const crystal = new THREE.Mesh(geometry, material);
                
                crystal.position.x = (Math.random() - 0.5) * 200;
                crystal.position.y = (Math.random() - 0.5) * 200;
                crystal.position.z = -100 - Math.random() * 600;
                
                crystal.userData = {
                    rotationSpeed: (Math.random() - 0.5) * 0.03,
                    collected: false
                };
                
                scene.add(crystal);
                crystals.push(crystal);
            }
        }
        
        // –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–µ—Ç
        function generatePlanets(count) {
            for (let i = 0; i < count; i++) {
                const size = 15 + Math.random() * 20;
                const geometry = new THREE.SphereGeometry(size, 32, 32);
                
                // –°–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç –ø–ª–∞–Ω–µ—Ç—ã
                const colors = [0x4488ff, 0xff8844, 0x44ff88, 0x8844ff, 0xffff44];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                const material = new THREE.MeshPhongMaterial({
                    color: color,
                    shininess: 30,
                    emissive: 0x111111
                });
                
                const planet = new THREE.Mesh(geometry, material);
                
                planet.position.x = (Math.random() - 0.5) * 300;
                planet.position.y = (Math.random() - 0.5) * 300;
                planet.position.z = -400 - Math.random() * 800;
                
                planet.userData = {
                    size: size,
                    planetData: planetData[Math.floor(Math.random() * planetData.length)]
                };
                
                scene.add(planet);
                planets.push(planet);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function updateGameState() {
            if (!gameState.gameActive || !ship) return;
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è –≤–ø–µ—Ä–µ–¥ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ)
            ship.position.z += gameState.speed;
            
            // –ü–æ–≤–æ—Ä–æ—Ç –∫–æ—Ä–∞–±–ª—è –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ
            if (gameState.touchControls.left) {
                ship.rotation.z += gameState.rotationSpeed;
            }
            if (gameState.touchControls.right) {
                ship.rotation.z -= gameState.rotationSpeed;
            }
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è –≤ —Å—Ç–æ—Ä–æ–Ω—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–≤–æ—Ä–æ—Ç–∞
            ship.position.x -= Math.sin(ship.rotation.z) * gameState.speed;
            ship.position.y += Math.cos(ship.rotation.z) * gameState.speed;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∫–∞–º–µ—Ä—ã
            camera.position.x = ship.position.x;
            camera.position.y = ship.position.y;
            camera.position.z = ship.position.z + 20;
            camera.lookAt(ship.position.x, ship.position.y, ship.position.z - 10);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤ (–æ–Ω–∏ —Å—Ç–æ—è—Ç –Ω–∞ –º–µ—Å—Ç–µ, –∞ –∫–æ—Ä–∞–±–ª—å –¥–≤–∏–∂–µ—Ç—Å—è)
            asteroids.forEach((asteroid, index) => {
                asteroid.rotation.x += asteroid.userData.rotationSpeed.x;
                asteroid.rotation.y += asteroid.userData.rotationSpeed.y;
                asteroid.rotation.z += asteroid.userData.rotationSpeed.z;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –∫–æ—Ä–∞–±–ª–µ–º
                const distance = Math.sqrt(
                    Math.pow(asteroid.position.x - ship.position.x, 2) +
                    Math.pow(asteroid.position.y - ship.position.y, 2) +
                    Math.pow(asteroid.position.z - ship.position.z, 2)
                );
                
                if (distance < 10) {
                    if (gameState.isShieldActive) {
                        gameState.shieldEnergy -= 20;
                    } else {
                        gameState.health -= 10;
                    }
                    
                    scene.remove(asteroid);
                    asteroids.splice(index, 1);
                    generateAsteroids(1);
                }
                
                // –ï—Å–ª–∏ –∞—Å—Ç–µ—Ä–æ–∏–¥ –æ—Å—Ç–∞–ª—Å—è –ø–æ–∑–∞–¥–∏, —É–¥–∞–ª—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≤–ø–µ—Ä–µ–¥–∏
                if (asteroid.position.z > ship.position.z + 100) {
                    scene.remove(asteroid);
                    asteroids.splice(index, 1);
                    
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∞—Å—Ç–µ—Ä–æ–∏–¥ –≤–ø–µ—Ä–µ–¥–∏
                    const newAsteroid = createAsteroid();
                    newAsteroid.position.z = ship.position.z - 500 - Math.random() * 300;
                    asteroids.push(newAsteroid);
                }
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–∞–∂–µ—Å–∫–∏—Ö –∫–æ—Ä–∞–±–ª–µ–π
            enemyShips.forEach((enemy, index) => {
                // –í—Ä–∞–≥–∏ –¥–≤–∏–∂—É—Ç—Å—è –∫ –∫–æ—Ä–∞–±–ª—é
                const dx = ship.position.x - enemy.position.x;
                const dy = ship.position.y - enemy.position.y;
                const dz = ship.position.z - enemy.position.z;
                
                const distance = Math.sqrt(dx * dx + dy * dy + dz * dz);
                
                if (distance < 100) {
                    // –ï—Å–ª–∏ –±–ª–∏–∑–∫–æ, –ø—Ä–µ—Å–ª–µ–¥—É–µ–º –∏–≥—Ä–æ–∫–∞
                    enemy.position.x += dx * 0.01;
                    enemy.position.y += dy * 0.01;
                }
                
                // –í—Ä–∞–≥–∏ –≤—Å–µ–≥–¥–∞ –ª–µ—Ç—è—Ç –≤–ø–µ—Ä–µ–¥ —Å —Ç–æ–π –∂–µ —Å–∫–æ—Ä–æ—Å—Ç—å—é, —á—Ç–æ –∏ –∫–æ—Ä–∞–±–ª—å
                enemy.position.z += gameState.speed;
                
                const collisionDistance = Math.sqrt(
                    Math.pow(enemy.position.x - ship.position.x, 2) +
                    Math.pow(enemy.position.y - ship.position.y, 2) +
                    Math.pow(enemy.position.z - ship.position.z, 2)
                );
                
                if (collisionDistance < 8) {
                    if (gameState.isShieldActive) {
                        gameState.shieldEnergy -= 15;
                    } else {
                        gameState.health -= 15;
                    }
                    
                    scene.remove(enemy);
                    enemyShips.splice(index, 1);
                    gameState.fragments += 5;
                    generateEnemyShips(1);
                }
                
                // –ï—Å–ª–∏ –≤—Ä–∞–≥ –æ—Å—Ç–∞–ª—Å—è –ø–æ–∑–∞–¥–∏, —É–¥–∞–ª—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –≤–ø–µ—Ä–µ–¥–∏
                if (enemy.position.z > ship.position.z + 100) {
                    scene.remove(enemy);
                    enemyShips.splice(index, 1);
                    generateEnemyShips(1);
                }
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –∑–≤—ë–∑–¥
            starFields.forEach((star, index) => {
                star.rotation.y += star.userData.rotationSpeed;
                
                const distance = Math.sqrt(
                    Math.pow(star.position.x - ship.position.x, 2) +
                    Math.pow(star.position.y - ship.position.y, 2) +
                    Math.pow(star.position.z - ship.position.z, 2)
                );
                
                if (distance < 7 && !star.userData.collected) {
                    star.userData.collected = true;
                    gameState.stars += 1;
                    gameState.score += 10;
                    
                    star.scale.set(0.1, 0.1, 0.1);
                    
                    setTimeout(() => {
                        scene.remove(star);
                        starFields.splice(index, 1);
                        generateStarFields(1);
                    }, 300);
                }
                
                // –ï—Å–ª–∏ –∑–≤–µ–∑–¥–∞ –æ—Å—Ç–∞–ª–∞—Å—å –ø–æ–∑–∞–¥–∏, —É–¥–∞–ª—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –≤–ø–µ—Ä–µ–¥–∏
                if (star.position.z > ship.position.z + 100) {
                    scene.remove(star);
                    starFields.splice(index, 1);
                    generateStarFields(1);
                }
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤
            crystals.forEach((crystal, index) => {
                crystal.rotation.y += crystal.userData.rotationSpeed;
                
                const distance = Math.sqrt(
                    Math.pow(crystal.position.x - ship.position.x, 2) +
                    Math.pow(crystal.position.y - ship.position.y, 2) +
                    Math.pow(crystal.position.z - ship.position.z, 2)
                );
                
                if (distance < 6 && !crystal.userData.collected) {
                    crystal.userData.collected = true;
                    gameState.fragments += 2;
                    gameState.score += 20;
                    
                    crystal.scale.set(0.1, 0.1, 0.1);
                    
                    setTimeout(() => {
                        scene.remove(crystal);
                        crystals.splice(index, 1);
                        generateCrystals(1);
                    }, 300);
                }
                
                // –ï—Å–ª–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª –æ—Å—Ç–∞–ª—Å—è –ø–æ–∑–∞–¥–∏, —É–¥–∞–ª—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≤–ø–µ—Ä–µ–¥–∏
                if (crystal.position.z > ship.position.z + 100) {
                    scene.remove(crystal);
                    crystals.splice(index, 1);
                    generateCrystals(1);
                }
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–∞–¥–∫–∏
            planets.forEach((planet, index) => {
                // –ü–ª–∞–Ω–µ—Ç—ã –¥–≤–∏–∂—É—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –∫–æ—Ä–∞–±–ª–µ–º
                planet.position.z += gameState.speed;
                planet.rotation.y += 0.005;
                
                const distance = Math.sqrt(
                    Math.pow(planet.position.x - ship.position.x, 2) +
                    Math.pow(planet.position.y - ship.position.y, 2) +
                    Math.pow(planet.position.z - ship.position.z, 2)
                );
                
                // –ï—Å–ª–∏ –±–ª–∏–∑–∫–æ –∫ –ø–ª–∞–Ω–µ—Ç–µ, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–æ—Å–∞–¥–∫—É
                if (distance < planet.userData.size + 10) {
                    landOnPlanet(planet);
                }
                
                // –ï—Å–ª–∏ –ø–ª–∞–Ω–µ—Ç–∞ –æ—Å—Ç–∞–ª–∞—Å—å –ø–æ–∑–∞–¥–∏, —É–¥–∞–ª—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –≤–ø–µ—Ä–µ–¥–∏
                if (planet.position.z > ship.position.z + 100) {
                    scene.remove(planet);
                    planets.splice(index, 1);
                    generatePlanets(1);
                }
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ —â–∏—Ç–∞
            if (!gameState.isShieldActive && gameState.shieldEnergy < 100) {
                gameState.shieldEnergy = Math.min(gameState.shieldEnergy + 0.1, 100);
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateUI();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
            if (gameState.health <= 0) {
                gameOver();
            }
            
            // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á—ë—Ç–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
            gameState.score += gameState.speed * 0.1;
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∞—Å—Ç–µ—Ä–æ–∏–¥–∞
        function createAsteroid() {
            const size = Math.random() * 5 + 1;
            const geometry = new THREE.IcosahedronGeometry(size, 0);
            const material = new THREE.MeshPhongMaterial({
                color: 0x888888,
                shininess: 30
            });
            
            const asteroid = new THREE.Mesh(geometry, material);
            
            asteroid.position.x = (Math.random() - 0.5) * 200;
            asteroid.position.y = (Math.random() - 0.5) * 200;
            asteroid.position.z = ship.position.z - 500 - Math.random() * 300;
            
            asteroid.rotation.x = Math.random() * Math.PI;
            asteroid.rotation.y = Math.random() * Math.PI;
            
            asteroid.userData = {
                rotationSpeed: {
                    x: (Math.random() - 0.5) * 0.02,
                    y: (Math.random() - 0.5) * 0.02,
                    z: (Math.random() - 0.5) * 0.02
                }
            };
            
            scene.add(asteroid);
            return asteroid;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            document.getElementById('healthValue').textContent = Math.max(0, Math.round(gameState.health));
            document.getElementById('speedValue').textContent = Math.round(gameState.speed * 100);
            document.getElementById('shieldValue').textContent = Math.round(gameState.shieldEnergy);
            document.getElementById('starsValue').textContent = gameState.stars;
            document.getElementById('fragmentsValue').textContent = gameState.fragments;
            document.getElementById('scoreValue').textContent = Math.round(gameState.score);
        }
        
        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —â–∏—Ç–∞
        function activateShield() {
            if (gameState.shieldEnergy >= 20 && !gameState.isShieldActive && ship) {
                gameState.isShieldActive = true;
                
                const shieldGeometry = new THREE.SphereGeometry(6, 16, 16);
                const shieldMaterial = new THREE.MeshBasicMaterial({
                    color: 0x00ffff,
                    transparent: true,
                    opacity: 0.3,
                    wireframe: true
                });
                
                const shield = new THREE.Mesh(shieldGeometry, shieldMaterial);
                ship.add(shield);
                
                setTimeout(() => {
                    if (shield.parent) {
                        ship.remove(shield);
                    }
                    gameState.isShieldActive = false;
                }, 3000);
            }
        }
        
        // –ü–æ—Å–∞–¥–∫–∞ –Ω–∞ –ø–ª–∞–Ω–µ—Ç—É
        function landOnPlanet(planet) {
            gameState.gameActive = false;
            gameState.currentPlanet = planet;
            
            // –£–±–∏—Ä–∞–µ–º –ø–ª–∞–Ω–µ—Ç—É –∏–∑ —Å—Ü–µ–Ω—ã
            scene.remove(planet);
            planets = planets.filter(p => p !== planet);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–ª–∞–Ω–µ—Ç—ã
            document.getElementById('planetName').textContent = planet.userData.planetData.name;
            document.getElementById('planetDialogue').textContent = 
                `${planet.userData.planetData.dialogue}\n\n${planet.userData.planetData.trader.name}: "${getTraderGreeting(planet.userData.planetData.trader.mood)}"`;
            
            showScreen('planetScreen');
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è —Ç–æ—Ä–≥–æ–≤—Ü–∞
        function getTraderGreeting(mood) {
            const greetings = {
                '–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π': '–ü—Ä–∏–≤–µ—Ç, —Å—Ç—Ä–∞–Ω–Ω–∏–∫! –•–æ—á–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ–π —Ç–æ–≤–∞—Ä?',
                '–≥—Ä—É–±—ã–π': '–ù—É —á–µ–≥–æ —É—Å—Ç–∞–≤–∏–ª—Å—è? –ü–æ–∫—É–ø–∞—Ç—å –±—É–¥–µ—à—å –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å—Ç–æ—è—Ç—å?',
                '—É—á—ë–Ω—ã–π': '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ... –¢—ã –ø–µ—Ä–≤—ã–π, –∫—Ç–æ –ø–æ—Å–µ—Ç–∏–ª —ç—Ç–∏ —Ä—É–∏–Ω—ã –∑–∞ –º–Ω–æ–≥–æ –ª–µ—Ç.',
                '–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π': '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å. –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É—Å–ª—É–≥.'
            };
            return greetings[mood] || '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?';
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ –ø–ª–∞–Ω–µ—Ç–µ
        function handlePlanetAction(action) {
            const dialogue = document.getElementById('planetDialogue');
            const tradeInterface = document.getElementById('tradeInterface');
            
            switch(action) {
                case 'trade':
                    tradeInterface.style.display = 'block';
                    dialogue.textContent = '–ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?';
                    break;
                case 'talk':
                    const responses = [
                        '–ú–µ—Å—Ç–Ω—ã–µ –ª–µ–≥–µ–Ω–¥—ã –≥–æ–≤–æ—Ä—è—Ç –æ –¥—Ä–µ–≤–Ω–µ–π —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏, –æ—Å—Ç–∞–≤–∏–≤—à–µ–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ —ç—Ç–∏—Ö –∑–≤—ë–∑–¥–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.',
                        '–ë—É–¥—å –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω –≤ —Å–µ–∫—Ç–æ—Ä–µ N-7, —Ç–∞–º –≤–∏–¥–µ–ª–∏ –∫–æ—Ä–∞–±–ª–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è.',
                        '–ï—Å–ª–∏ –Ω–∞–π–¥—ë—à—å –≥–æ–ª—É–±—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã - –Ω–µ –ø—Ä–æ–¥–∞–≤–∞–π –∏—Ö –ø–µ—Ä–≤–æ–º—É –≤—Å—Ç—Ä–µ—á–Ω–æ–º—É, –æ–Ω–∏ —Ü–µ–Ω–Ω—ã –¥–ª—è —É—á—ë–Ω—ã—Ö.',
                        '–ù–∞ —ç—Ç–æ–π –ø–ª–∞–Ω–µ—Ç–µ –∫–æ–≥–¥–∞-—Ç–æ –±—ã–ª–∞ –≤–µ–ª–∏–∫–∞—è –∏–º–ø–µ—Ä–∏—è, –Ω–æ —Ç–µ–ø–µ—Ä—å –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏—à—å —Ä—É–∏–Ω—ã.'
                    ];
                    dialogue.textContent = responses[Math.floor(Math.random() * responses.length)];
                    break;
                case 'repair':
                    if (gameState.fragments >= 30) {
                        gameState.health = Math.min(gameState.health + 50, 100);
                        gameState.fragments -= 30;
                        dialogue.textContent = '–ö–æ—Ä–∞–±–ª—å –æ—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω! –ó–¥–æ—Ä–æ–≤—å–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.';
                    } else {
                        dialogue.textContent = '–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±–ª–æ–º–∫–æ–≤ –¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞ (–Ω—É–∂–Ω–æ 30üîß).';
                    }
                    break;
                case 'upgrade':
                    if (gameState.stars >= 5) {
                        gameState.speed += 0.1;
                        gameState.stars -= 5;
                        dialogue.textContent = '–î–≤–∏–≥–∞—Ç–µ–ª—å —É–ª—É—á—à–µ–Ω! –°–∫–æ—Ä–æ—Å—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∞.';
                    } else {
                        dialogue.textContent = '–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è (–Ω—É–∂–Ω–æ 5‚≠ê).';
                    }
                    break;
                case 'mission':
                    const missions = [
                        '–°–æ–±–µ—Ä–∏ 10 –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ –≤ —Å–æ—Å–µ–¥–Ω–µ–π —Å–∏—Å—Ç–µ–º–µ –∏ –ø–æ–ª—É—á–∏—à—å 50‚≠ê.',
                        '–£–Ω–∏—á—Ç–æ–∂—å 5 –≤—Ä–∞–∂–µ—Å–∫–∏—Ö –∫–æ—Ä–∞–±–ª–µ–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ —â–∏—Ç–∞.',
                        '–ù–∞–π–¥–∏ –¥—Ä–µ–≤–Ω–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –≤ –∞—Å—Ç–µ—Ä–æ–∏–¥–Ω–æ–º –ø–æ–ª–µ –∑–∞ 100üîß.'
                    ];
                    dialogue.textContent = '–ó–∞–¥–∞–Ω–∏–µ: ' + missions[Math.floor(Math.random() * missions.length)];
                    break;
                case 'leave':
                    tradeInterface.style.display = 'none';
                    showScreen('gameScreen');
                    gameState.gameActive = true;
                    generatePlanets(1); // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –ø–ª–∞–Ω–µ—Ç—É
                    break;
                case 'buyStars':
                    if (gameState.fragments >= 10) {
                        gameState.stars += 1;
                        gameState.fragments -= 10;
                        dialogue.textContent = '–ü–æ–∫—É–ø–∫–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–ª—É—á–µ–Ω–∞ 1‚≠ê.';
                    } else {
                        dialogue.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±–ª–æ–º–∫–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ (–Ω—É–∂–Ω–æ 10üîß).';
                    }
                    break;
                case 'sellStars':
                    if (gameState.stars >= 1) {
                        gameState.stars -= 1;
                        gameState.fragments += 8;
                        dialogue.textContent = '–ü—Ä–æ–¥–∞–∂–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–ª—É—á–µ–Ω–æ 8üîß.';
                    } else {
                        dialogue.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ (–Ω—É–∂–Ω–æ 1‚≠ê).';
                    }
                    break;
                case 'buyShield':
                    if (gameState.fragments >= 50) {
                        gameState.shieldEnergy = 100;
                        gameState.fragments -= 50;
                        dialogue.textContent = '–©–∏—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!';
                    } else {
                        dialogue.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±–ª–æ–º–∫–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —â–∏—Ç–∞ (–Ω—É–∂–Ω–æ 50üîß).';
                    }
                    break;
                case 'back':
                    tradeInterface.style.display = 'none';
                    dialogue.textContent = '–ß–µ–º –µ—â—ë –º–æ–≥—É –ø–æ–º–æ—á—å?';
                    break;
            }
            updateUI();
        }
        
        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        function gameOver() {
            gameState.gameActive = false;
            document.getElementById('finalScore').textContent = Math.round(gameState.score);
            showScreen('gameOver');
        }
        
        // –ù–æ–≤–∞—è –∏–≥—Ä–∞
        function startGame() {
            gameState.health = 100;
            gameState.stars = 0;
            gameState.fragments = 0;
            gameState.score = 0;
            gameState.speed = 0.5;
            gameState.isShieldActive = false;
            gameState.shieldEnergy = 100;
            gameState.gameActive = true;
            
            if (ship) {
                ship.position.x = 0;
                ship.position.y = 0;
                ship.position.z = 15;
                ship.rotation.z = 0;
            }
            
            // –û—á–∏—Å—Ç–∫–∞ —Å—Ü–µ–Ω—ã
            asteroids.forEach(asteroid => scene.remove(asteroid));
            enemyShips.forEach(enemy => scene.remove(enemy));
            starFields.forEach(star => scene.remove(star));
            crystals.forEach(crystal => scene.remove(crystal));
            planets.forEach(planet => scene.remove(planet));
            
            asteroids = [];
            enemyShips = [];
            starFields = [];
            crystals = [];
            planets = [];
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
            generateAsteroids(15);
            generateEnemyShips(5);
            generateStarFields(8);
            generateCrystals(5);
            generatePlanets(3);
            
            showScreen('gameScreen');
            updateUI();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω
        function showScreen(screenId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω
            document.getElementById(screenId).classList.remove('hidden');
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function setupTouchControls() {
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');
            const forwardBtn = document.getElementById('forwardBtn');
            const restartBtn = document.getElementById('restartBtn');
            const startBtn = document.getElementById('startBtn');
            const menuBtn = document.getElementById('menuBtn');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const addButtonHandler = (button, controlName) => {
                button.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    gameState.touchControls[controlName] = true;
                    button.classList.add('active');
                });
                
                button.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    gameState.touchControls[controlName] = false;
                    button.classList.remove('active');
                });
                
                // –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
                button.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    gameState.touchControls[controlName] = true;
                    button.classList.add('active');
                });
                
                button.addEventListener('mouseup', (e) => {
                    e.preventDefault();
                    gameState.touchControls[controlName] = false;
                    button.classList.remove('active');
                });
            };
            
            addButtonHandler(leftBtn, 'left');
            addButtonHandler(rightBtn, 'right');
            
            // –ö–Ω–æ–ø–∫–∞ "–≤–ø–µ—Ä–µ–¥" –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —â–∏—Ç
            forwardBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                activateShield();
                forwardBtn.classList.add('active');
                setTimeout(() => forwardBtn.classList.remove('active'), 300);
            });
            
            forwardBtn.addEventListener('mousedown', (e) => {
                e.preventDefault();
                activateShield();
                forwardBtn.classList.add('active');
                setTimeout(() => forwardBtn.classList.remove('active'), 300);
            });
            
            // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            startBtn.addEventListener('click', () => {
                startGame();
            });
            
            restartBtn.addEventListener('click', () => {
                startGame();
            });
            
            menuBtn.addEventListener('click', () => {
                gameState.gameActive = false;
                showScreen('menuScreen');
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–ª–∞–Ω–µ—Ç—ã
            document.querySelectorAll('.trader-option').forEach(option => {
                option.addEventListener('click', () => {
                    const action = option.getAttribute('data-action') || option.getAttribute('data-trade');
                    if (action) {
                        handlePlanetAction(action);
                    }
                });
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            window.addEventListener('resize', () => {
                if (camera && renderer) {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                }
            });
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (scene && camera && renderer) {
                updateGameState();
                renderer.render(scene, camera);
            }
            requestAnimationFrame(gameLoop);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            // –°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Three.js
            if (!initThreeJS()) {
                return;
            }
            
            // –ó–∞—Ç–µ–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            setupEventListeners();
            setupTouchControls();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é
            showScreen('menuScreen');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            gameLoop();
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', init);
    </script>
</body>
</html>