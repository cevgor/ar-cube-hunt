<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–•—Ä–æ–Ω–∏–∫–∏ –ø–∞–¥–∞—é—â–∏—Ö –∑–≤—ë–∑–¥ | –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Ä–µ–π–¥–µ—Ä</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            background: #000;
            color: #0ff;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        #gameContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        #ui {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 5, 15, 0.95);
            z-index: 20;
        }
        
        .hidden {
            display: none;
        }
        
        .hud {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 16px;
            text-shadow: 0 0 10px #0ff;
            background: rgba(0, 0, 0, 0.8);
            padding: 12px;
            border: 2px solid #0ff;
            border-radius: 8px;
        }
        
        .resources {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 16px;
            text-shadow: 0 0 10px #0ff;
            background: rgba(0, 0, 0, 0.8);
            padding: 12px;
            border: 2px solid #0ff;
            border-radius: 8px;
            text-align: right;
        }
        
        /* –ü—Ä–æ—Å—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - 3 –∫–Ω–æ–ø–∫–∏ */
        .simple-controls {
            position: absolute;
            bottom: 30px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 40px;
            pointer-events: auto;
        }
        
        .control-btn {
            width: 90px;
            height: 90px;
            border-radius: 20px;
            background: rgba(0, 255, 255, 0.4);
            border: 3px solid #0ff;
            color: #0ff;
            font-size: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 0 25px #0ff;
            touch-action: manipulation;
            transition: all 0.1s;
        }
        
        .control-btn:active {
            background: rgba(0, 255, 255, 0.8);
            transform: scale(0.95);
            box-shadow: 0 0 40px #0ff;
        }
        
        .btn {
            background: transparent;
            color: #0ff;
            border: 2px solid #0ff;
            padding: 15px 30px;
            margin: 15px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.3s;
            border-radius: 8px;
            text-shadow: 0 0 5px #0ff;
            box-shadow: 0 0 15px #0ff;
        }
        
        .btn:active {
            background: rgba(0, 255, 255, 0.2);
        }
        
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0) 0%,
                rgba(255,255,255,0.03) 50%,
                rgba(255,255,255,0) 100%
            );
            background-size: 100% 3px;
            pointer-events: none;
            z-index: 5;
        }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 28px;
            text-align: center;
            z-index: 100;
            text-shadow: 0 0 10px #0ff;
        }
        
        .planet-interface {
            background: rgba(0, 15, 40, 0.95);
            padding: 40px;
            border: 3px solid #0ff;
            border-radius: 20px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 0 40px #0ff;
        }
        
        .dialogue {
            margin: 25px 0;
            padding: 20px;
            border: 2px solid #0ff;
            border-radius: 12px;
            background: rgba(0, 25, 50, 0.8);
            font-size: 16px;
            line-height: 1.5;
        }
        
        .trader-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 25px 0;
        }
        
        .trader-option {
            padding: 15px;
            border: 2px solid #0ff;
            border-radius: 8px;
            background: rgba(0, 40, 80, 0.7);
            cursor: pointer;
            text-align: center;
            pointer-events: auto;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .trader-option:active {
            background: rgba(0, 60, 120, 0.9);
            transform: scale(0.98);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-height: 600px) {
            .hud, .resources {
                font-size: 14px;
                padding: 8px;
            }
            
            .control-btn {
                width: 80px;
                height: 80px;
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div id="loading" class="loading pulse">–ó–ê–ì–†–£–ó–ö–ê –ö–û–°–ú–ò–ß–ï–°–ö–û–ì–û –†–ï–ô–î–ï–†–ê...</div>
    <div id="gameContainer"></div>
    <div id="ui">
        <div class="scanlines"></div>
        
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="menuScreen" class="screen">
            <h1 style="font-size: 3.5rem; margin-bottom: 2rem; text-shadow: 0 0 20px #0ff;" class="pulse">–ö–û–°–ú–ò–ß–ï–°–ö–ò–ô –†–ï–ô–î–ï–†</h1>
            <p style="margin-bottom: 40px; text-align: center; font-size: 1.2rem;">–ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ –≥–∞–ª–∞–∫—Ç–∏–∫—É</p>
            <button class="btn" id="startBtn">–°–¢–ê–†–¢</button>
        </div>
        
        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div id="gameScreen" class="screen hidden">
            <div class="hud">
                <div>‚ù§Ô∏è –ó–î–û–†–û–í–¨–ï: <span id="healthValue">100</span>%</div>
                <div>üöÄ –°–ö–û–†–û–°–¢–¨: <span id="speedValue">50</span></div>
                <div>üõ°Ô∏è –©–ò–¢: <span id="shieldValue">100</span>%</div>
                <div>üéØ –ü–†–ò–¶–ï–õ: <span id="targetValue">0</span></div>
            </div>
            
            <div class="resources">
                <div>‚≠ê –ó–í–Å–ó–î–´: <span id="starsValue">0</span></div>
                <div>üíé –ö–†–ò–°–¢–ê–õ–õ–´: <span id="fragmentsValue">0</span></div>
                <div>üèÜ –û–ß–ö–ò: <span id="scoreValue">0</span></div>
                <div>üéØ –ú–ò–°–°–ò–Ø: <span id="missionValue">0/5</span></div>
            </div>
            
            <div class="simple-controls">
                <div class="control-btn" id="leftBtn">‚Üê</div>
                <div class="control-btn" id="shieldBtn">üõ°Ô∏è</div>
                <div class="control-btn" id="shootBtn">üí•</div>
                <div class="control-btn" id="rightBtn">‚Üí</div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –ø–ª–∞–Ω–µ—Ç—ã -->
        <div id="planetScreen" class="screen hidden">
            <div class="planet-interface">
                <h2 id="planetName" style="text-align: center; margin-bottom: 20px; text-shadow: 0 0 10px #0ff;">–ü–õ–ê–ù–ï–¢–ê</h2>
                <div class="dialogue" id="planetDialogue">
                    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –ø–ª–∞–Ω–µ—Ç—É! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?
                </div>
                
                <div class="trader-options">
                    <div class="trader-option" data-action="trade">üõí –¢–û–†–ì–û–í–ê–¢–¨</div>
                    <div class="trader-option" data-action="talk">üí¨ –ü–û–ë–û–õ–¢–ê–¢–¨</div>
                    <div class="trader-option" data-action="repair">üîß –ü–û–ß–ò–ù–ò–¢–¨ –ö–û–†–ê–ë–õ–¨</div>
                    <div class="trader-option" data-action="upgrade">‚ö° –£–õ–£–ß–®–ï–ù–ò–Ø</div>
                    <div class="trader-option" data-action="mission">üéØ –ó–ê–î–ê–ù–ò–ï</div>
                    <div class="trader-option" data-action="leave">üöÄ –£–õ–ï–¢–ï–¢–¨</div>
                </div>
                
                <div id="tradeInterface" style="display: none; margin-top: 25px;">
                    <h3 style="text-align: center; margin-bottom: 15px;">üõí –¢–û–†–ì–û–í–õ–Ø</h3>
                    <div class="trader-options">
                        <div class="trader-option" data-trade="buyStars">–ö–£–ü–ò–¢–¨ ‚≠ê (10üíé)</div>
                        <div class="trader-option" data-trade="sellStars">–ü–†–û–î–ê–¢–¨ ‚≠ê (8üíé)</div>
                        <div class="trader-option" data-trade="buyShield">–ö–£–ü–ò–¢–¨ –©–ò–¢ (50üíé)</div>
                        <div class="trader-option" data-trade="back">‚Üê –ù–ê–ó–ê–î</div>
                    </div>
                </div>

                <div id="upgradeInterface" style="display: none; margin-top: 25px;">
                    <h3 style="text-align: center; margin-bottom: 15px;">‚ö° –£–õ–£–ß–®–ï–ù–ò–Ø</h3>
                    <div class="trader-options">
                        <div class="trader-option" data-upgrade="engine">üöÄ –î–í–ò–ì–ê–¢–ï–õ–¨ (5‚≠ê)</div>
                        <div class="trader-option" data-upgrade="shield">üõ°Ô∏è –£–°–ò–õ–ï–ù–ò–ï –©–ò–¢–ê (8‚≠ê)</div>
                        <div class="trader-option" data-upgrade="weapon">üí• –û–†–£–ñ–ò–ï (10‚≠ê)</div>
                        <div class="trader-option" data-upgrade="back">‚Üê –ù–ê–ó–ê–î</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã -->
        <div id="gameOver" class="screen hidden">
            <div style="background: rgba(0, 0, 0, 0.95); padding: 40px; border: 3px solid #f00; text-align: center; border-radius: 15px; box-shadow: 0 0 40px #f00;">
                <h2 style="color: #f00; text-shadow: 0 0 10px #f00;">–ö–û–†–ê–ë–õ–¨ –£–ù–ò–ß–¢–û–ñ–ï–ù</h2>
                <p style="margin: 25px 0; font-size: 20px;">–í–∞—à —Å—á—ë—Ç: <span id="finalScore">0</span></p>
                <button class="btn" id="restartBtn">–ù–û–í–ê–Ø –ò–ì–†–ê</button>
                <button class="btn" id="menuBtn">–ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</button>
            </div>
        </div>
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É Three.js
        if (typeof THREE === 'undefined') {
            document.getElementById('loading').innerHTML = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Three.js. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.';
            throw new Error('Three.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        }

        let scene, camera, renderer, ship;
        let asteroids = [], enemyShips = [], starFields = [], planets = [], crystals = [];
        let engineParticles = [], nebulas = [], bullets = [];
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameState = {
            health: 100,
            stars: 0,
            fragments: 0,
            score: 0,
            speed: 2.0, // –£–≤–µ–ª–∏—á–∏–ª —Å–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è –±–æ–ª–µ–µ –¥–∏–Ω–∞–º–∏—á–Ω–æ–π –∏–≥—Ä—ã
            rotationSpeed: 0.03,
            isShieldActive: false,
            shieldEnergy: 100,
            gameActive: false,
            touchControls: {
                left: false,
                right: false,
                shoot: false
            },
            currentPlanet: null,
            mission: {
                type: 'collect',
                target: 5,
                progress: 0,
                reward: 100
            },
            upgrades: {
                engine: 1,
                shield: 1,
                weapon: 1
            }
        };

        // –ü–ª–∞–Ω–µ—Ç—ã –∏ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏—è
        const planetData = [
            { 
                name: "–ö–†–ò–û–ù–ò–°", 
                dialogue: "–õ–µ–¥—è–Ω–æ–π –≥–∏–≥–∞–Ω—Ç —Å —Å–∏—è—é—â–∏–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–º–∏ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è–º–∏.",
                color: 0x88ccff,
                size: 25
            },
            { 
                name: "–ü–ò–†–û–°", 
                dialogue: "–†–∞—Å–∫–∞–ª—ë–Ω–Ω—ã–π –º–∏—Ä —Å –≤—É–ª–∫–∞–Ω–∏—á–µ—Å–∫–∏–º–∏ –º–æ—Ä—è–º–∏ –ª–∞–≤—ã.",
                color: 0xff6633,
                size: 30
            },
            { 
                name: "–í–ï–†–î–ê–ù–¢", 
                dialogue: "–ó–µ–ª—ë–Ω—ã–π –º–∏—Ä —Å –±–∏–æ–ª—é–º–∏–Ω–µ—Å—Ü–µ–Ω—Ç–Ω—ã–º–∏ –ª–µ—Å–∞–º–∏.",
                color: 0x44ff88,
                size: 22
            },
            { 
                name: "–ù–ï–ö–°–£–°", 
                dialogue: "–ì–∏–≥–∞–Ω—Ç—Å–∫–∞—è –∫–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è - —Ü–µ–Ω—Ç—Ä —Ç–æ—Ä–≥–æ–≤–ª–∏.",
                color: 0x8888ff,
                size: 35
            },
            { 
                name: "–ê–£–†–ï–õ–ò–Ø", 
                dialogue: "–ó–æ–ª–æ—Ç–∞—è –ø–ª–∞–Ω–µ—Ç–∞ —Å —Ä–µ–¥–∫–∏–º–∏ –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–º–∏ —Ñ–æ—Ä–º–∞–º–∏ –∂–∏–∑–Ω–∏.",
                color: 0xffdd44,
                size: 28
            }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Three.js
        function initThreeJS() {
            try {
                // –°—Ü–µ–Ω–∞
                scene = new THREE.Scene();
                
                // –ö–∞–º–µ—Ä–∞ - –æ—Ç–æ–¥–≤–∏–≥–∞–µ–º –¥–∞–ª—å—à–µ
                camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 5000);
                
                // –†–µ–Ω–¥–µ—Ä–µ—Ä —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
                renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: true
                });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x001122, 1); // –°–¥–µ–ª–∞–µ–º —Ñ–æ–Ω —Å–≤–µ—Ç–ª–µ–µ
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                document.getElementById('gameContainer').appendChild(renderer.domElement);
                
                // –£–ª—É—á—à–µ–Ω–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ - –°–î–ï–õ–ê–ï–ú –Ø–†–ß–ï
                const ambientLight = new THREE.AmbientLight(0x666688, 1.2); // –£–≤–µ–ª–∏—á–∏–ª –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5); // –Ø—Ä—á–µ
                directionalLight.position.set(5, 5, 10);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                scene.add(directionalLight);
                
                const pointLight = new THREE.PointLight(0x4488ff, 1.5, 200); // –Ø—Ä—á–µ –∏ –¥–∞–ª—å—à–µ
                pointLight.position.set(0, 0, 50);
                scene.add(pointLight);

                // –î–æ–±–∞–≤–∏–º –µ—â–µ –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–≤–µ—Ç–∞ —Å–ø–µ—Ä–µ–¥–∏
                const frontLight = new THREE.PointLight(0x88aaff, 0.8, 300);
                frontLight.position.set(0, 0, 100);
                scene.add(frontLight);
                
                // –ó–≤—ë–∑–¥–Ω–æ–µ –Ω–µ–±–æ
                createStarfield();
                
                // –¢—É–º–∞–Ω–Ω–æ—Å—Ç–∏
                createNebulas();
                
                // –ö–æ—Ä–∞–±–ª—å –∏–≥—Ä–æ–∫–∞
                createShip();
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                document.getElementById('loading').style.display = 'none';
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Three.js:', error);
                document.getElementById('loading').innerHTML = '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ 3D. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É WebGL.';
                return false;
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤—ë–∑–¥–Ω–æ–≥–æ –Ω–µ–±–∞
        function createStarfield() {
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 5000; // –ë–æ–ª—å—à–µ –∑–≤–µ–∑–¥
            const starPositions = new Float32Array(starCount * 3);
            const starColors = new Float32Array(starCount * 3);
            const starSizes = new Float32Array(starCount);
            
            for (let i = 0; i < starCount * 3; i += 3) {
                starPositions[i] = (Math.random() - 0.5) * 4000; // –£–≤–µ–ª–∏—á–∏–ª –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
                starPositions[i + 1] = (Math.random() - 0.5) * 4000;
                starPositions[i + 2] = (Math.random() - 0.5) * 4000;
                
                // –†–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ –∑–≤–µ–∑–¥
                const colorChoice = Math.random();
                if (colorChoice < 0.6) {
                    starColors[i] = 1; starColors[i + 1] = 1; starColors[i + 2] = 1; // –ë–µ–ª—ã–π
                } else if (colorChoice < 0.8) {
                    starColors[i] = 0.8; starColors[i + 1] = 0.9; starColors[i + 2] = 1; // –ì–æ–ª—É–±–æ–π
                } else {
                    starColors[i] = 1; starColors[i + 1] = 0.8; starColors[i + 2] = 0.6; // –ñ–µ–ª—Ç—ã–π
                }

                // –†–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∑–≤–µ–∑–¥
                starSizes[i/3] = Math.random() * 3 + 0.5;
            }
            
            starGeometry.setAttribute('position', new THREE.BufferAttribute(starPositions, 3));
            starGeometry.setAttribute('color', new THREE.BufferAttribute(starColors, 3));
            starGeometry.setAttribute('size', new THREE.BufferAttribute(starSizes, 1));
            
            const starMaterial = new THREE.PointsMaterial({
                size: 3,
                sizeAttenuation: true,
                vertexColors: true,
                transparent: true
            });
            
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç—É–º–∞–Ω–Ω–æ—Å—Ç–µ–π
        function createNebulas() {
            for (let i = 0; i < 5; i++) { // –ë–æ–ª—å—à–µ —Ç—É–º–∞–Ω–Ω–æ—Å—Ç–µ–π
                const nebulaGeometry = new THREE.SphereGeometry(400 + Math.random() * 300, 16, 16);
                const nebulaMaterial = new THREE.MeshBasicMaterial({
                    color: new THREE.Color().setHSL(Math.random(), 0.7, 0.5), // –Ø—Ä—á–µ
                    transparent: true,
                    opacity: 0.08, // –ü—Ä–æ–∑—Ä–∞—á–Ω–µ–µ
                    side: THREE.BackSide
                });
                
                const nebula = new THREE.Mesh(nebulaGeometry, nebulaMaterial);
                nebula.position.set(
                    (Math.random() - 0.5) * 2000,
                    (Math.random() - 0.5) * 2000,
                    (Math.random() - 0.5) * 2000
                );
                scene.add(nebula);
                nebulas.push(nebula);
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è - –ü–ï–†–ï–í–ï–†–ù–£–õ –ü–†–ê–í–ò–õ–¨–ù–û
        function createShip() {
            const group = new THREE.Group();
            
            // –ö–æ—Ä–ø—É—Å –∫–æ—Ä–∞–±–ª—è - –ø–µ—Ä–µ–≤–µ—Ä–Ω—É–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ
            const hullGeometry = new THREE.ConeGeometry(4, 12, 4);
            const hullMaterial = new THREE.MeshPhongMaterial({
                color: 0x00aaff,
                shininess: 100,
                emissive: 0x0044aa // –Ø—Ä—á–µ —Å–≤–µ—á–µ–Ω–∏–µ
            });
            const hull = new THREE.Mesh(hullGeometry, hullMaterial);
            hull.rotation.x = -Math.PI / 2; // –ü–†–ê–í–ò–õ–¨–ù–û–ï –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï
            group.add(hull);
            
            // –ö—Ä—ã–ª—å—è
            const wingGeometry = new THREE.BoxGeometry(8, 1, 4);
            const wingMaterial = new THREE.MeshPhongMaterial({
                color: 0x0088ff,
                shininess: 80,
                emissive: 0x002266
            });
            const leftWing = new THREE.Mesh(wingGeometry, wingMaterial);
            leftWing.position.set(-6, 0, 0);
            group.add(leftWing);
            
            const rightWing = new THREE.Mesh(wingGeometry, wingMaterial);
            rightWing.position.set(6, 0, 0);
            group.add(rightWing);
            
            // –î–≤–∏–≥–∞—Ç–µ–ª–∏
            const engineGeometry = new THREE.CylinderGeometry(1.5, 2, 3, 8);
            const engineMaterial = new THREE.MeshPhongMaterial({
                color: 0xff6600,
                emissive: 0xff3300,
                shininess: 30
            });
            const leftEngine = new THREE.Mesh(engineGeometry, engineMaterial);
            leftEngine.position.set(-3, 0, 4); // –ü–µ—Ä–µ–º–µ—Å—Ç–∏–ª –¥–≤–∏–≥–∞—Ç–µ–ª–∏ –≤–ø–µ—Ä–µ–¥
            leftEngine.rotation.x = Math.PI / 2;
            group.add(leftEngine);
            
            const rightEngine = new THREE.Mesh(engineGeometry, engineMaterial);
            rightEngine.position.set(3, 0, 4);
            rightEngine.rotation.x = Math.PI / 2;
            group.add(rightEngine);
            
            group.position.z = 15;
            group.position.y = 0;
            scene.add(group);
            ship = group;
            
            // –°–æ–∑–¥–∞–µ–º —á–∞—Å—Ç–∏—Ü—ã –¥–≤–∏–≥–∞—Ç–µ–ª—è
            createEngineParticles();
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –¥–≤–∏–≥–∞—Ç–µ–ª—è
        function createEngineParticles() {
            const particleCount = 30; // –ë–æ–ª—å—à–µ —á–∞—Å—Ç–∏—Ü
            const particles = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);
            
            for (let i = 0; i < particleCount * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 3;
                positions[i + 1] = (Math.random() - 0.5) * 3;
                positions[i + 2] = 5 + Math.random() * 8; // –ß–∞—Å—Ç–∏—Ü—ã –≤—ã—Ö–æ–¥—è—Ç –∏–∑ –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π
                
                // –û—Ä–∞–Ω–∂–µ–≤–æ-–∂–µ–ª—Ç—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —á–∞—Å—Ç–∏—Ü
                colors[i] = 1;     // R
                colors[i + 1] = 0.5 + Math.random() * 0.5; // G
                colors[i + 2] = 0;   // B
            }
            
            particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            particles.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const particleMaterial = new THREE.PointsMaterial({
                size: 3,
                vertexColors: true,
                transparent: true,
                opacity: 0.9,
                blending: THREE.AdditiveBlending
            });
            
            const particleSystem = new THREE.Points(particles, particleMaterial);
            ship.add(particleSystem);
            engineParticles.push(particleSystem);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –¥–≤–∏–≥–∞—Ç–µ–ª—è
        function updateEngineParticles() {
            engineParticles.forEach(particles => {
                const positions = particles.geometry.attributes.position.array;
                for (let i = 0; i < positions.length; i += 3) {
                    positions[i + 2] += 0.8 + Math.random() * 0.8; // –ß–∞—Å—Ç–∏—Ü—ã –ª–µ—Ç—è—Ç –Ω–∞–∑–∞–¥
                    if (positions[i + 2] > 15) {
                        positions[i + 2] = 5 + Math.random() * 3;
                        positions[i] = (Math.random() - 0.5) * 3;
                        positions[i + 1] = (Math.random() - 0.5) * 3;
                    }
                }
                particles.geometry.attributes.position.needsUpdate = true;
            });
        }
        
        // –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤ - –†–ï–î–ï–ï –ò –î–ê–õ–¨–®–ï
        function generateAsteroids(count) {
            for (let i = 0; i < count; i++) {
                // 30% —à–∞–Ω—Å –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞—Å—Ç–µ—Ä–æ–∏–¥ - —á–∏—Å—Ç—ã–µ –∑–æ–Ω—ã
                if (Math.random() < 0.3) continue;
                
                const size = Math.random() * 8 + 3; // –ë–æ–ª—å—à–µ –∞—Å—Ç–µ—Ä–æ–∏–¥—ã
                const geometry = new THREE.IcosahedronGeometry(size, 1);
                const material = new THREE.MeshPhongMaterial({
                    color: 0xcccccc, // –°–≤–µ—Ç–ª–µ–µ
                    shininess: 50,
                    emissive: 0x444444
                });
                
                const asteroid = new THREE.Mesh(geometry, material);
                
                // –†–∞–∑–º–µ—â–∞–µ–º –¥–∞–ª—å—à–µ –∏ —Ä–µ–∂–µ
                asteroid.position.x = (Math.random() - 0.5) * 800;
                asteroid.position.y = (Math.random() - 0.5) * 200; // –î–æ–±–∞–≤–∏–º –≤—ã—Å–æ—Ç—É
                asteroid.position.z = -200 - Math.random() * 1500;
                
                asteroid.rotation.x = Math.random() * Math.PI;
                asteroid.rotation.y = Math.random() * Math.PI;
                
                asteroid.userData = {
                    rotationSpeed: {
                        x: (Math.random() - 0.5) * 0.02,
                        y: (Math.random() - 0.5) * 0.02,
                        z: (Math.random() - 0.5) * 0.02
                    }
                };
                
                asteroid.castShadow = true;
                scene.add(asteroid);
                asteroids.push(asteroid);
            }
        }
        
        // –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–∞–∂–µ—Å–∫–∏—Ö –∫–æ—Ä–∞–±–ª–µ–π
        function generateEnemyShips(count) {
            for (let i = 0; i < count; i++) {
                // 40% —à–∞–Ω—Å –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Ä–∞–≥–∞ - —á–∏—Å—Ç—ã–µ –∑–æ–Ω—ã
                if (Math.random() < 0.4) continue;
                
                const geometry = new THREE.OctahedronGeometry(5, 0); // –ë–æ–ª—å—à–µ –≤—Ä–∞–≥–∏
                const material = new THREE.MeshPhongMaterial({
                    color: 0xff3300,
                    shininess: 100,
                    emissive: 0x880000
                });
                
                const enemyShip = new THREE.Mesh(geometry, material);
                
                enemyShip.position.x = (Math.random() - 0.5) * 600;
                enemyShip.position.y = (Math.random() - 0.5) * 150;
                enemyShip.position.z = -300 - Math.random() * 1200;
                
                enemyShip.userData = {
                    health: 30,
                    speed: 0.5 + Math.random() * 0.5
                };
                
                enemyShip.castShadow = true;
                scene.add(enemyShip);
                enemyShips.push(enemyShip);
            }
        }
        
        // –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –∑–≤—ë–∑–¥ (—Ä–µ—Å—É—Ä—Å—ã)
        function generateStarFields(count) {
            for (let i = 0; i < count; i++) {
                const geometry = new THREE.SphereGeometry(4, 16, 16); // –ë–æ–ª—å—à–µ –∑–≤–µ–∑–¥—ã
                const material = new THREE.MeshPhongMaterial({
                    color: 0xffff00,
                    shininess: 100,
                    emissive: 0x888800 // –Ø—Ä—á–µ —Å–≤–µ—á–µ–Ω–∏–µ
                });
                
                const starField = new THREE.Mesh(geometry, material);
                
                starField.position.x = (Math.random() - 0.5) * 700;
                starField.position.y = (Math.random() - 0.5) * 180;
                starField.position.z = -250 - Math.random() * 1300;
                
                starField.userData = {
                    rotationSpeed: (Math.random() - 0.5) * 0.05,
                    collected: false
                };
                
                starField.castShadow = true;
                scene.add(starField);
                starFields.push(starField);
            }
        }
        
        // –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤
        function generateCrystals(count) {
            for (let i = 0; i < count; i++) {
                const geometry = new THREE.OctahedronGeometry(3, 0); // –ë–æ–ª—å—à–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã
                const material = new THREE.MeshPhongMaterial({
                    color: 0xff00ff,
                    shininess: 100,
                    emissive: 0x880088 // –Ø—Ä—á–µ —Å–≤–µ—á–µ–Ω–∏–µ
                });
                
                const crystal = new THREE.Mesh(geometry, material);
                
                crystal.position.x = (Math.random() - 0.5) * 750;
                crystal.position.y = (Math.random() - 0.5) * 200;
                crystal.position.z = -200 - Math.random() * 1400;
                
                crystal.userData = {
                    rotationSpeed: (Math.random() - 0.5) * 0.03,
                    collected: false
                };
                
                crystal.castShadow = true;
                scene.add(crystal);
                crystals.push(crystal);
            }
        }
        
        // –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–µ—Ç
        function generatePlanets(count) {
            for (let i = 0; i < count; i++) {
                const planetInfo = planetData[Math.floor(Math.random() * planetData.length)];
                const geometry = new THREE.SphereGeometry(planetInfo.size, 32, 32);
                
                const material = new THREE.MeshPhongMaterial({
                    color: planetInfo.color,
                    shininess: 50,
                    emissive: new THREE.Color(planetInfo.color).multiplyScalar(0.3) // –Ø—Ä—á–µ —Å–≤–µ—á–µ–Ω–∏–µ
                });
                
                const planet = new THREE.Mesh(geometry, material);
                
                planet.position.x = (Math.random() - 0.5) * 1000;
                planet.position.y = (Math.random() - 0.5) * 300;
                planet.position.z = -600 - Math.random() * 2000;
                
                planet.userData = {
                    size: planetInfo.size,
                    planetData: planetInfo
                };
                
                planet.castShadow = true;
                scene.add(planet);
                planets.push(planet);
            }
        }

        // –°—Ç—Ä–µ–ª—å–±–∞
        function shoot() {
            if (!gameState.gameActive || !ship) return;
            
            const bulletGeometry = new THREE.SphereGeometry(0.8, 8, 8);
            const bulletMaterial = new THREE.MeshBasicMaterial({
                color: 0xffff00,
                emissive: 0xffff00
            });
            
            const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);
            
            // –ü–æ–∑–∏—Ü–∏—è –ø—É–ª–∏ –ø–µ—Ä–µ–¥ –∫–æ—Ä–∞–±–ª–µ–º
            bullet.position.copy(ship.position);
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(ship.quaternion);
            bullet.position.add(direction.multiplyScalar(-10));
            
            bullet.userData = {
                velocity: direction.clone().multiplyScalar(15 * gameState.upgrades.weapon), // –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É–ª—É—á—à–µ–Ω–∏—è
                lifetime: 100
            };
            
            scene.add(bullet);
            bullets.push(bullet);
            
            // –≠—Ñ—Ñ–µ–∫—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞
            createMuzzleFlash(ship.position, direction);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–ø—ã—à–∫–∏ –≤—ã—Å—Ç—Ä–µ–ª–∞
        function createMuzzleFlash(position, direction) {
            const flashGeometry = new THREE.SphereGeometry(2, 8, 8);
            const flashMaterial = new THREE.MeshBasicMaterial({
                color: 0xffff00,
                transparent: true,
                opacity: 0.8
            });
            
            const flash = new THREE.Mesh(flashGeometry, flashMaterial);
            flash.position.copy(position);
            flash.position.add(direction.multiplyScalar(-8));
            scene.add(flash);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
            let scale = 1;
            const shrink = setInterval(() => {
                scale -= 0.2;
                flash.scale.set(scale, scale, scale);
                flashMaterial.opacity = scale * 0.8;
                
                if (scale <= 0) {
                    clearInterval(shrink);
                    scene.remove(flash);
                }
            }, 50);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function updateGameState() {
            if (!gameState.gameActive || !ship) return;
            
            // –ö–æ—Ä–∞–±–ª—å –≤—Å–µ–≥–¥–∞ –ª–µ—Ç–∏—Ç –í–ü–ï–†–Å–î –ø–æ —Å–≤–æ–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Å–∏ Z
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(ship.quaternion);
            
            // –î–≤–∏–≥–∞–µ–º –∫–æ—Ä–∞–±–ª—å –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –µ–≥–æ –Ω–æ—Å–∞ —Å —É—á–µ—Ç–æ–º —É–ª—É—á—à–µ–Ω–∏–π
            ship.position.add(direction.multiplyScalar(gameState.speed * gameState.upgrades.engine));
            
            // –ü–æ–≤–æ—Ä–æ—Ç –∫–æ—Ä–∞–±–ª—è –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ
            if (gameState.touchControls.left) {
                ship.rotation.y += gameState.rotationSpeed;
            }
            if (gameState.touchControls.right) {
                ship.rotation.y -= gameState.rotationSpeed;
            }

            // –°—Ç—Ä–µ–ª—å–±–∞
            if (gameState.touchControls.shoot) {
                if (Date.now() - (gameState.lastShot || 0) > 300 / gameState.upgrades.weapon) { // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç—Ä–µ–ª—å–Ω–æ—Å—Ç–∏
                    shoot();
                    gameState.lastShot = Date.now();
                }
            }
            
            // –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ö–ê–ú–ï–†–ê - —Å–ª–µ–¥—É–µ—Ç –∑–∞ –∫–æ—Ä–∞–±–ª–µ–º –∏ —Å–º–æ—Ç—Ä–∏—Ç –≤–ø–µ—Ä–µ–¥
            const cameraOffset = new THREE.Vector3(0, 8, 25); // –û—Ç–æ–¥–≤–∏–Ω—É–ª –∫–∞–º–µ—Ä—É –¥–∞–ª—å—à–µ –∏ –≤—ã—à–µ
            cameraOffset.applyQuaternion(ship.quaternion);
            camera.position.copy(ship.position).add(cameraOffset);
            
            // –ö–∞–º–µ—Ä–∞ –≤—Å–µ–≥–¥–∞ —Å–º–æ—Ç—Ä–∏—Ç –≤–ø–µ—Ä–µ–¥ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫–æ—Ä–∞–±–ª—è
            const lookAtPoint = ship.position.clone();
            const lookDirection = new THREE.Vector3(0, 0, -1);
            lookDirection.applyQuaternion(ship.quaternion);
            lookAtPoint.add(lookDirection.multiplyScalar(50)); // –°–º–æ—Ç—Ä–∏–º –¥–∞–ª–µ–∫–æ –≤–ø–µ—Ä–µ–¥
            camera.lookAt(lookAtPoint);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –¥–≤–∏–≥–∞—Ç–µ–ª—è
            updateEngineParticles();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É–ª—å
            updateBullets();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤
            asteroids.forEach((asteroid, index) => {
                asteroid.rotation.x += asteroid.userData.rotationSpeed.x;
                asteroid.rotation.y += asteroid.userData.rotationSpeed.y;
                asteroid.rotation.z += asteroid.userData.rotationSpeed.z;
                
                // –ê—Å—Ç–µ—Ä–æ–∏–¥—ã –º–µ–¥–ª–µ–Ω–Ω–æ –¥–≤–∏–∂—É—Ç—Å—è –Ω–∞–≤—Å—Ç—Ä–µ—á—É
                asteroid.position.z += 0.5;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –∫–æ—Ä–∞–±–ª–µ–º
                const distance = ship.position.distanceTo(asteroid.position);
                
                if (distance < asteroid.geometry.parameters.radius + 8) {
                    if (gameState.isShieldActive) {
                        gameState.shieldEnergy -= 15;
                        // –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å–∫–æ–∫–∞ –ø—Ä–∏ —â–∏—Ç–µ
                        const pushDirection = asteroid.position.clone().sub(ship.position).normalize();
                        asteroid.position.add(pushDirection.multiplyScalar(10));
                    } else {
                        gameState.health -= 15;
                        // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è
                        ship.scale.set(1.2, 1.2, 1.2);
                        setTimeout(() => ship.scale.set(1, 1, 1), 200);
                    }
                    
                    createExplosion(asteroid.position);
                    scene.remove(asteroid);
                    asteroids.splice(index, 1);
                    generateAsteroids(1);
                }
                
                // –ï—Å–ª–∏ –∞—Å—Ç–µ—Ä–æ–∏–¥ —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –ø–æ–∑–∞–¥–∏, —É–¥–∞–ª—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≤–ø–µ—Ä–µ–¥–∏
                if (asteroid.position.z > ship.position.z + 300) {
                    scene.remove(asteroid);
                    asteroids.splice(index, 1);
                    generateAsteroids(1);
                }
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–∞–∂–µ—Å–∫–∏—Ö –∫–æ—Ä–∞–±–ª–µ–π
            enemyShips.forEach((enemy, index) => {
                // –í—Ä–∞–≥–∏ –¥–≤–∏–∂—É—Ç—Å—è –∫ –∫–æ—Ä–∞–±–ª—é
                const dx = ship.position.x - enemy.position.x;
                const dz = ship.position.z - enemy.position.z;
                
                const distance = Math.sqrt(dx * dx + dz * dz);
                
                if (distance < 200) {
                    // –ï—Å–ª–∏ –±–ª–∏–∑–∫–æ, –ø—Ä–µ—Å–ª–µ–¥—É–µ–º –∏–≥—Ä–æ–∫–∞
                    enemy.position.x += dx * 0.008 * enemy.userData.speed;
                    enemy.position.z += dz * 0.008 * enemy.userData.speed;
                }
                
                // –í—Ä–∞–≥–∏ —Ç–æ–∂–µ —Å—Ç—Ä–µ–ª—è—é—Ç
                if (Math.random() < 0.005 && distance < 150) {
                    createEnemyLaser(enemy.position, ship.position);
                }
                
                const collisionDistance = ship.position.distanceTo(enemy.position);
                
                if (collisionDistance < 12) {
                    if (gameState.isShieldActive) {
                        gameState.shieldEnergy -= 20;
                    } else {
                        gameState.health -= 20;
                    }
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç –≤–∑—Ä—ã–≤–∞
                    createExplosion(enemy.position);
                    
                    scene.remove(enemy);
                    enemyShips.splice(index, 1);
                    gameState.fragments += 8;
                    gameState.score += 50;
                    generateEnemyShips(1);
                }
                
                // –ï—Å–ª–∏ –≤—Ä–∞–≥ —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –ø–æ–∑–∞–¥–∏, —É–¥–∞–ª—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –≤–ø–µ—Ä–µ–¥–∏
                if (enemy.position.z > ship.position.z + 400) {
                    scene.remove(enemy);
                    enemyShips.splice(index, 1);
                    generateEnemyShips(1);
                }
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –∑–≤—ë–∑–¥
            starFields.forEach((star, index) => {
                star.rotation.y += star.userData.rotationSpeed;
                
                const distance = ship.position.distanceTo(star.position);
                
                if (distance < 10 && !star.userData.collected) {
                    star.userData.collected = true;
                    gameState.stars += 1;
                    gameState.score += 15;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∏—Å—Å–∏—é
                    if (gameState.mission.type === 'collect') {
                        gameState.mission.progress++;
                    }
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç —Å–±–æ—Ä–∞
                    star.scale.set(0.1, 0.1, 0.1);
                    createCollectEffect(star.position);
                    
                    setTimeout(() => {
                        scene.remove(star);
                        starFields.splice(index, 1);
                        generateStarFields(1);
                    }, 300);
                }
                
                // –ï—Å–ª–∏ –∑–≤–µ–∑–¥–∞ —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –ø–æ–∑–∞–¥–∏, —É–¥–∞–ª—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –≤–ø–µ—Ä–µ–¥–∏
                if (star.position.z > ship.position.z + 400) {
                    scene.remove(star);
                    starFields.splice(index, 1);
                    generateStarFields(1);
                }
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤
            crystals.forEach((crystal, index) => {
                crystal.rotation.y += crystal.userData.rotationSpeed;
                
                const distance = ship.position.distanceTo(crystal.position);
                
                if (distance < 8 && !crystal.userData.collected) {
                    crystal.userData.collected = true;
                    gameState.fragments += 3;
                    gameState.score += 25;
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç —Å–±–æ—Ä–∞
                    crystal.scale.set(0.1, 0.1, 0.1);
                    createCollectEffect(crystal.position);
                    
                    setTimeout(() => {
                        scene.remove(crystal);
                        crystals.splice(index, 1);
                        generateCrystals(1);
                    }, 300);
                }
                
                // –ï—Å–ª–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –ø–æ–∑–∞–¥–∏, —É–¥–∞–ª—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≤–ø–µ—Ä–µ–¥–∏
                if (crystal.position.z > ship.position.z + 400) {
                    scene.remove(crystal);
                    crystals.splice(index, 1);
                    generateCrystals(1);
                }
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–∞–¥–∫–∏
            planets.forEach((planet, index) => {
                planet.rotation.y += 0.002;
                
                const distance = ship.position.distanceTo(planet.position);
                
                // –ï—Å–ª–∏ –±–ª–∏–∑–∫–æ –∫ –ø–ª–∞–Ω–µ—Ç–µ, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–æ—Å–∞–¥–∫—É
                if (distance < planet.userData.size + 25) {
                    landOnPlanet(planet);
                }
                
                // –ï—Å–ª–∏ –ø–ª–∞–Ω–µ—Ç–∞ —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –ø–æ–∑–∞–¥–∏, —É–¥–∞–ª—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –≤–ø–µ—Ä–µ–¥–∏
                if (planet.position.z > ship.position.z + 600) {
                    scene.remove(planet);
                    planets.splice(index, 1);
                    generatePlanets(1);
                }
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ —â–∏—Ç–∞
            if (!gameState.isShieldActive && gameState.shieldEnergy < 100) {
                gameState.shieldEnergy = Math.min(gameState.shieldEnergy + 0.15, 100);
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateUI();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏—Å—Å–∏–∏
            if (gameState.mission.progress >= gameState.mission.target) {
                completeMission();
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
            if (gameState.health <= 0) {
                gameOver();
            }
            
            // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á—ë—Ç–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
            gameState.score += gameState.speed * 0.2;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É–ª—å
        function updateBullets() {
            bullets.forEach((bullet, index) => {
                // –î–≤–∏–≥–∞–µ–º –ø—É–ª—é
                bullet.position.add(bullet.userData.velocity);
                bullet.userData.lifetime--;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è –ø—É–ª–∏ —Å –≤—Ä–∞–≥–∞–º–∏
                enemyShips.forEach((enemy, enemyIndex) => {
                    if (bullet.position.distanceTo(enemy.position) < 8) {
                        enemy.userData.health -= 10 * gameState.upgrades.weapon;
                        
                        if (enemy.userData.health <= 0) {
                            createExplosion(enemy.position);
                            scene.remove(enemy);
                            enemyShips.splice(enemyIndex, 1);
                            gameState.fragments += 10;
                            gameState.score += 100;
                            generateEnemyShips(1);
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∏—Å—Å–∏—é —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è
                            if (gameState.mission.type === 'destroy') {
                                gameState.mission.progress++;
                            }
                        }
                        
                        // –£–¥–∞–ª—è–µ–º –ø—É–ª—é
                        scene.remove(bullet);
                        bullets.splice(index, 1);
                    }
                });
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –∞—Å—Ç–µ—Ä–æ–∏–¥–∞–º–∏
                asteroids.forEach((asteroid, asteroidIndex) => {
                    if (bullet.position.distanceTo(asteroid.position) < asteroid.geometry.parameters.radius + 2) {
                        createExplosion(bullet.position);
                        scene.remove(bullet);
                        bullets.splice(index, 1);
                    }
                });
                
                // –£–¥–∞–ª—è–µ–º –ø—É–ª—é –µ—Å–ª–∏ –æ–Ω–∞ –¥–∞–ª–µ–∫–æ –∏–ª–∏ –∏—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏
                if (bullet.userData.lifetime <= 0 || 
                    bullet.position.distanceTo(ship.position) > 500) {
                    scene.remove(bullet);
                    bullets.splice(index, 1);
                }
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ª–∞–∑–µ—Ä–∞ –≤—Ä–∞–≥–∞
        function createEnemyLaser(from, to) {
            const direction = to.clone().sub(from).normalize();
            const laserGeometry = new THREE.CylinderGeometry(0.3, 0.3, 20, 8);
            const laserMaterial = new THREE.MeshBasicMaterial({
                color: 0xff0000,
                emissive: 0xff0000
            });
            
            const laser = new THREE.Mesh(laserGeometry, laserMaterial);
            laser.position.copy(from);
            laser.lookAt(to);
            laser.rotateX(Math.PI / 2);
            
            laser.userData = {
                velocity: direction.clone().multiplyScalar(10),
                lifetime: 60
            };
            
            scene.add(laser);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –∏–≥—Ä–æ–∫–æ–º
            const laserInterval = setInterval(() => {
                laser.position.add(laser.userData.velocity);
                laser.userData.lifetime--;
                
                if (laser.userData.lifetime <= 0) {
                    clearInterval(laserInterval);
                    scene.remove(laser);
                }
                
                if (laser.position.distanceTo(ship.position) < 8) {
                    if (gameState.isShieldActive) {
                        gameState.shieldEnergy -= 10;
                    } else {
                        gameState.health -= 10;
                        ship.scale.set(1.1, 1.1, 1.1);
                        setTimeout(() => ship.scale.set(1, 1, 1), 100);
                    }
                    clearInterval(laserInterval);
                    scene.remove(laser);
                    createExplosion(laser.position);
                }
            }, 50);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –≤–∑—Ä—ã–≤–∞
        function createExplosion(position) {
            const particleCount = 20;
            const particles = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);
            
            for (let i = 0; i < particleCount * 3; i += 3) {
                positions[i] = position.x + (Math.random() - 0.5) * 8;
                positions[i + 1] = position.y + (Math.random() - 0.5) * 8;
                positions[i + 2] = position.z + (Math.random() - 0.5) * 8;
                
                colors[i] = 1;     // R
                colors[i + 1] = 0.3 + Math.random() * 0.4; // G
                colors[i + 2] = 0;   // B
            }
            
            particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            particles.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const particleMaterial = new THREE.PointsMaterial({
                size: 4,
                vertexColors: true,
                transparent: true,
                opacity: 1,
                blending: THREE.AdditiveBlending
            });
            
            const particleSystem = new THREE.Points(particles, particleMaterial);
            scene.add(particleSystem);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
            let opacity = 1;
            const fadeInterval = setInterval(() => {
                opacity -= 0.05;
                particleMaterial.opacity = opacity;
                
                if (opacity <= 0) {
                    clearInterval(fadeInterval);
                    scene.remove(particleSystem);
                }
            }, 50);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å–±–æ—Ä–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
        function createCollectEffect(position) {
            const particleCount = 12;
            const particles = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);
            
            for (let i = 0; i < particleCount * 3; i += 3) {
                positions[i] = position.x + (Math.random() - 0.5) * 4;
                positions[i + 1] = position.y + (Math.random() - 0.5) * 4;
                positions[i + 2] = position.z + (Math.random() - 0.5) * 4;
                
                colors[i] = 1;     // R
                colors[i + 1] = 1; // G
                colors[i + 2] = 0;   // B
            }
            
            particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            particles.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const particleMaterial = new THREE.PointsMaterial({
                size: 3,
                vertexColors: true,
                transparent: true,
                opacity: 1,
                blending: THREE.AdditiveBlending
            });
            
            const particleSystem = new THREE.Points(particles, particleMaterial);
            scene.add(particleSystem);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
            let opacity = 1;
            const fadeInterval = setInterval(() => {
                opacity -= 0.1;
                particleMaterial.opacity = opacity;
                
                if (opacity <= 0) {
                    clearInterval(fadeInterval);
                    scene.remove(particleSystem);
                }
            }, 50);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            document.getElementById('healthValue').textContent = Math.max(0, Math.round(gameState.health));
            document.getElementById('speedValue').textContent = Math.round(gameState.speed * gameState.upgrades.engine * 50);
            document.getElementById('shieldValue').textContent = Math.round(gameState.shieldEnergy);
            document.getElementById('starsValue').textContent = gameState.stars;
            document.getElementById('fragmentsValue').textContent = gameState.fragments;
            document.getElementById('scoreValue').textContent = Math.round(gameState.score);
            document.getElementById('missionValue').textContent = `${gameState.mission.progress}/${gameState.mission.target}`;
            document.getElementById('targetValue').textContent = enemyShips.length;
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–∏—Å—Å–∏–∏
        function completeMission() {
            gameState.stars += gameState.mission.reward;
            gameState.score += gameState.mission.reward * 10;
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–ª—É—á–∞–π–Ω—É—é –º–∏—Å—Å–∏—é
            const missionTypes = ['collect', 'destroy'];
            gameState.mission = {
                type: missionTypes[Math.floor(Math.random() * missionTypes.length)],
                target: 5 + Math.floor(Math.random() * 6),
                progress: 0,
                reward: 100 + Math.floor(Math.random() * 100)
            };
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –º–∏—Å—Å–∏–∏
            if (gameState.gameActive) {
                const message = document.createElement('div');
                message.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.9);
                    color: #0ff;
                    padding: 20px;
                    border: 2px solid #0ff;
                    border-radius: 10px;
                    font-size: 24px;
                    z-index: 100;
                    text-align: center;
                `;
                message.innerHTML = `üéâ –ú–ò–°–°–ò–Ø –í–´–ü–û–õ–ù–ï–ù–ê!<br>+${gameState.mission.reward}‚≠ê`;
                document.body.appendChild(message);
                
                setTimeout(() => {
                    document.body.removeChild(message);
                }, 3000);
            }
        }
        
        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —â–∏—Ç–∞
        function activateShield() {
            if (gameState.shieldEnergy >= 25 && !gameState.isShieldActive && ship) {
                gameState.isShieldActive = true;
                gameState.shieldEnergy -= 25;
                
                const shieldGeometry = new THREE.SphereGeometry(10, 16, 16);
                const shieldMaterial = new THREE.MeshBasicMaterial({
                    color: 0x00ffff,
                    transparent: true,
                    opacity: 0.4,
                    wireframe: true
                });
                
                const shield = new THREE.Mesh(shieldGeometry, shieldMaterial);
                ship.add(shield);
                
                setTimeout(() => {
                    if (shield.parent) {
                        ship.remove(shield);
                    }
                    gameState.isShieldActive = false;
                }, 3000);
            }
        }
        
        // –ü–æ—Å–∞–¥–∫–∞ –Ω–∞ –ø–ª–∞–Ω–µ—Ç—É
        function landOnPlanet(planet) {
            gameState.gameActive = false;
            gameState.currentPlanet = planet;
            
            // –£–±–∏—Ä–∞–µ–º –ø–ª–∞–Ω–µ—Ç—É –∏–∑ —Å—Ü–µ–Ω—ã
            scene.remove(planet);
            planets = planets.filter(p => p !== planet);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–ª–∞–Ω–µ—Ç—ã
            document.getElementById('planetName').textContent = planet.userData.planetData.name;
            document.getElementById('planetDialogue').textContent = planet.userData.planetData.dialogue;
            
            showScreen('planetScreen');
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ –ø–ª–∞–Ω–µ—Ç–µ
        function handlePlanetAction(action) {
            const dialogue = document.getElementById('planetDialogue');
            const tradeInterface = document.getElementById('tradeInterface');
            const upgradeInterface = document.getElementById('upgradeInterface');
            
            switch(action) {
                case 'trade':
                    tradeInterface.style.display = 'block';
                    upgradeInterface.style.display = 'none';
                    dialogue.textContent = '–ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?';
                    break;
                case 'talk':
                    tradeInterface.style.display = 'none';
                    upgradeInterface.style.display = 'none';
                    const responses = [
                        '–ú–µ—Å—Ç–Ω—ã–µ –ª–µ–≥–µ–Ω–¥—ã –≥–æ–≤–æ—Ä—è—Ç –æ –¥—Ä–µ–≤–Ω–µ–π —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏, –æ—Å—Ç–∞–≤–∏–≤—à–µ–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ —ç—Ç–∏—Ö –∑–≤—ë–∑–¥–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.',
                        '–ë—É–¥—å –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω –≤ —Å–µ–∫—Ç–æ—Ä–µ N-7, —Ç–∞–º –≤–∏–¥–µ–ª–∏ –∫–æ—Ä–∞–±–ª–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è.',
                        '–ï—Å–ª–∏ –Ω–∞–π–¥—ë—à—å –≥–æ–ª—É–±—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã - –Ω–µ –ø—Ä–æ–¥–∞–≤–∞–π –∏—Ö –ø–µ—Ä–≤–æ–º—É –≤—Å—Ç—Ä–µ—á–Ω–æ–º—É, –æ–Ω–∏ —Ü–µ–Ω–Ω—ã –¥–ª—è —É—á—ë–Ω—ã—Ö.',
                        '–ù–∞ —ç—Ç–æ–π –ø–ª–∞–Ω–µ—Ç–µ –∫–æ–≥–¥–∞-—Ç–æ –±—ã–ª–∞ –≤–µ–ª–∏–∫–∞—è –∏–º–ø–µ—Ä–∏—è, –Ω–æ —Ç–µ–ø–µ—Ä—å –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏—à—å —Ä—É–∏–Ω—ã.'
                    ];
                    dialogue.textContent = responses[Math.floor(Math.random() * responses.length)];
                    break;
                case 'repair':
                    tradeInterface.style.display = 'none';
                    upgradeInterface.style.display = 'none';
                    if (gameState.fragments >= 30) {
                        gameState.health = Math.min(gameState.health + 50, 100);
                        gameState.fragments -= 30;
                        dialogue.textContent = '–ö–æ—Ä–∞–±–ª—å –æ—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω! –ó–¥–æ—Ä–æ–≤—å–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.';
                    } else {
                        dialogue.textContent = '–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ –¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞ (–Ω—É–∂–Ω–æ 30üíé).';
                    }
                    break;
                case 'upgrade':
                    tradeInterface.style.display = 'none';
                    upgradeInterface.style.display = 'block';
                    dialogue.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —É–ª—É—á—à–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ—Ä–∞–±–ª—è:';
                    break;
                case 'mission':
                    tradeInterface.style.display = 'none';
                    upgradeInterface.style.display = 'none';
                    dialogue.textContent = `–¢–µ–∫—É—â–∞—è –º–∏—Å—Å–∏—è: ${gameState.mission.type === 'collect' ? '–°–æ–±—Ä–∞—Ç—å' : '–£–Ω–∏—á—Ç–æ–∂–∏—Ç—å'} ${gameState.mission.target} ${gameState.mission.type === 'collect' ? '–∑–≤—ë–∑–¥' : '–≤—Ä–∞–≥–æ–≤'}. –ù–∞–≥—Ä–∞–¥–∞: ${gameState.mission.reward}‚≠ê (–ü—Ä–æ–≥—Ä–µ—Å—Å: ${gameState.mission.progress}/${gameState.mission.target})`;
                    break;
                case 'leave':
                    tradeInterface.style.display = 'none';
                    upgradeInterface.style.display = 'none';
                    showScreen('gameScreen');
                    gameState.gameActive = true;
                    generatePlanets(1); // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –ø–ª–∞–Ω–µ—Ç—É
                    break;
                case 'buyStars':
                    if (gameState.fragments >= 10) {
                        gameState.stars += 1;
                        gameState.fragments -= 10;
                        dialogue.textContent = '–ü–æ–∫—É–ø–∫–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–ª—É—á–µ–Ω–∞ 1‚≠ê.';
                    } else {
                        dialogue.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ (–Ω—É–∂–Ω–æ 10üíé).';
                    }
                    break;
                case 'sellStars':
                    if (gameState.stars >= 1) {
                        gameState.stars -= 1;
                        gameState.fragments += 8;
                        dialogue.textContent = '–ü—Ä–æ–¥–∞–∂–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–ª—É—á–µ–Ω–æ 8üíé.';
                    } else {
                        dialogue.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ (–Ω—É–∂–Ω–æ 1‚≠ê).';
                    }
                    break;
                case 'buyShield':
                    if (gameState.fragments >= 50) {
                        gameState.shieldEnergy = 100;
                        gameState.fragments -= 50;
                        dialogue.textContent = '–©–∏—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!';
                    } else {
                        dialogue.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —â–∏—Ç–∞ (–Ω—É–∂–Ω–æ 50üíé).';
                    }
                    break;
                case 'engine':
                    if (gameState.stars >= 5 * gameState.upgrades.engine) {
                        gameState.stars -= 5 * gameState.upgrades.engine;
                        gameState.upgrades.engine += 0.5;
                        dialogue.textContent = `–î–≤–∏–≥–∞—Ç–µ–ª—å —É–ª—É—á—à–µ–Ω! –£—Ä–æ–≤–µ–Ω—å: ${gameState.upgrades.engine}.`;
                    } else {
                        dialogue.textContent = `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è (–Ω—É–∂–Ω–æ ${5 * gameState.upgrades.engine}‚≠ê).`;
                    }
                    break;
                case 'shield':
                    if (gameState.stars >= 8 * gameState.upgrades.shield) {
                        gameState.stars -= 8 * gameState.upgrades.shield;
                        gameState.upgrades.shield += 0.5;
                        dialogue.textContent = `–©–∏—Ç —É—Å–∏–ª–µ–Ω! –£—Ä–æ–≤–µ–Ω—å: ${gameState.upgrades.shield}.`;
                    } else {
                        dialogue.textContent = `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è (–Ω—É–∂–Ω–æ ${8 * gameState.upgrades.shield}‚≠ê).`;
                    }
                    break;
                case 'weapon':
                    if (gameState.stars >= 10 * gameState.upgrades.weapon) {
                        gameState.stars -= 10 * gameState.upgrades.weapon;
                        gameState.upgrades.weapon += 0.5;
                        dialogue.textContent = `–û—Ä—É–∂–∏–µ —É–ª—É—á—à–µ–Ω–æ! –£—Ä–æ–≤–µ–Ω—å: ${gameState.upgrades.weapon}.`;
                    } else {
                        dialogue.textContent = `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è (–Ω—É–∂–Ω–æ ${10 * gameState.upgrades.weapon}‚≠ê).`;
                    }
                    break;
                case 'back':
                    tradeInterface.style.display = 'none';
                    upgradeInterface.style.display = 'none';
                    dialogue.textContent = '–ß–µ–º –µ—â—ë –º–æ–≥—É –ø–æ–º–æ—á—å?';
                    break;
            }
            updateUI();
        }
        
        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        function gameOver() {
            gameState.gameActive = false;
            document.getElementById('finalScore').textContent = Math.round(gameState.score);
            showScreen('gameOver');
        }
        
        // –ù–æ–≤–∞—è –∏–≥—Ä–∞
        function startGame() {
            gameState.health = 100;
            gameState.stars = 0;
            gameState.fragments = 0;
            gameState.score = 0;
            gameState.speed = 2.0;
            gameState.isShieldActive = false;
            gameState.shieldEnergy = 100;
            gameState.gameActive = true;
            gameState.upgrades = {
                engine: 1,
                shield: 1,
                weapon: 1
            };
            gameState.mission = {
                type: Math.random() > 0.5 ? 'collect' : 'destroy',
                target: 5,
                progress: 0,
                reward: 100
            };
            
            if (ship) {
                ship.position.x = 0;
                ship.position.y = 0;
                ship.position.z = 15;
                ship.rotation.y = 0;
            }
            
            // –û—á–∏—Å—Ç–∫–∞ —Å—Ü–µ–Ω—ã
            asteroids.forEach(asteroid => scene.remove(asteroid));
            enemyShips.forEach(enemy => scene.remove(enemy));
            starFields.forEach(star => scene.remove(star));
            crystals.forEach(crystal => scene.remove(crystal));
            planets.forEach(planet => scene.remove(planet));
            bullets.forEach(bullet => scene.remove(bullet));
            
            asteroids = [];
            enemyShips = [];
            starFields = [];
            crystals = [];
            planets = [];
            bullets = [];
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ - –ë–û–õ–¨–®–ï –ò –î–ê–õ–¨–®–ï
            generateAsteroids(30);
            generateEnemyShips(15);
            generateStarFields(20);
            generateCrystals(15);
            generatePlanets(6);
            
            showScreen('gameScreen');
            updateUI();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω
        function showScreen(screenId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω
            document.getElementById(screenId).classList.remove('hidden');
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function setupTouchControls() {
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');
            const shieldBtn = document.getElementById('shieldBtn');
            const shootBtn = document.getElementById('shootBtn');
            const restartBtn = document.getElementById('restartBtn');
            const startBtn = document.getElementById('startBtn');
            const menuBtn = document.getElementById('menuBtn');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const addButtonHandler = (button, controlName) => {
                button.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    gameState.touchControls[controlName] = true;
                });
                
                button.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    gameState.touchControls[controlName] = false;
                });
                
                // –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
                button.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    gameState.touchControls[controlName] = true;
                });
                
                button.addEventListener('mouseup', (e) => {
                    e.preventDefault();
                    gameState.touchControls[controlName] = false;
                });
                
                button.addEventListener('mouseleave', (e) => {
                    e.preventDefault();
                    gameState.touchControls[controlName] = false;
                });
            };
            
            addButtonHandler(leftBtn, 'left');
            addButtonHandler(rightBtn, 'right');
            addButtonHandler(shootBtn, 'shoot');
            
            // –ö–Ω–æ–ø–∫–∞ —â–∏—Ç–∞
            shieldBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                activateShield();
            });
            
            shieldBtn.addEventListener('mousedown', (e) => {
                e.preventDefault();
                activateShield();
            });
            
            // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            startBtn.addEventListener('click', () => {
                startGame();
            });
            
            restartBtn.addEventListener('click', () => {
                startGame();
            });
            
            menuBtn.addEventListener('click', () => {
                gameState.gameActive = false;
                showScreen('menuScreen');
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–ª–∞–Ω–µ—Ç—ã
            document.querySelectorAll('.trader-option').forEach(option => {
                option.addEventListener('click', () => {
                    const action = option.getAttribute('data-action') || 
                                 option.getAttribute('data-trade') || 
                                 option.getAttribute('data-upgrade');
                    if (action) {
                        handlePlanetAction(action);
                    }
                });
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            window.addEventListener('resize', () => {
                if (camera && renderer) {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                }
            });

            // –î–æ–±–∞–≤–ª—è–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            window.addEventListener('keydown', (e) => {
                if (!gameState.gameActive) return;
                
                switch(e.key) {
                    case 'ArrowLeft':
                    case 'a':
                        gameState.touchControls.left = true;
                        break;
                    case 'ArrowRight':
                    case 'd':
                        gameState.touchControls.right = true;
                        break;
                    case ' ':
                        gameState.touchControls.shoot = true;
                        break;
                    case 's':
                        activateShield();
                        break;
                }
            });

            window.addEventListener('keyup', (e) => {
                switch(e.key) {
                    case 'ArrowLeft':
                    case 'a':
                        gameState.touchControls.left = false;
                        break;
                    case 'ArrowRight':
                    case 'd':
                        gameState.touchControls.right = false;
                        break;
                    case ' ':
                        gameState.touchControls.shoot = false;
                        break;
                }
            });
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (scene && camera && renderer) {
                updateGameState();
                renderer.render(scene, camera);
            }
            requestAnimationFrame(gameLoop);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            // –°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Three.js
            if (!initThreeJS()) {
                return;
            }
            
            // –ó–∞—Ç–µ–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            setupEventListeners();
            setupTouchControls();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é
            showScreen('menuScreen');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            gameLoop();
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', init);
    </script>
</body>
</html>