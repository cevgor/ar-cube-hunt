<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ETHOS: CORE 2.0</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;500;800&display=swap" rel="stylesheet">

    <style>
        :root { --bg: #050505; --primary: #00ff9d; --secondary: #00d2ff; --danger: #ff2a6d; --gold: #ffd700; }
        body { background-color: var(--bg); color: #fff; font-family: 'JetBrains Mono', monospace; overflow: hidden; touch-action: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        [v-cloak] { display: none; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }

        /* FX */
        #matrix { position: fixed; top: 0; left: 0; opacity: 0.1; pointer-events: none; z-index: 0; }
        .scanlines { background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 2px, 3px 100%; position: fixed; inset: 0; pointer-events: none; z-index: 50; }
        
        /* UI */
        .cyber-btn {
            background: var(--primary); color: #000; clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            font-weight: 800; display: flex; align-items: center; justify-content: center; transition: all 0.1s;
        }
        .cyber-btn:active { transform: scale(0.96); filter: brightness(0.8); }
        
        /* CARD */
        .card-container { perspective: 1000px; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; position: relative; z-index: 20; }
        .game-card {
            width: 90%; max-width: 360px; height: 55vh; max-height: 500px;
            background: #111; border: 1px solid #333; border-radius: 16px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8); overflow: hidden; position: relative;
            transition: transform 0.3s ease-out, opacity 0.3s; will-change: transform;
        }
        
        /* DECISION BUTTONS */
        .decision-panel {
            position: absolute; bottom: 20px; width: 100%; padding: 0 20px;
            display: flex; justify-content: space-between; gap: 15px; z-index: 40;
        }
        .choice-btn {
            flex: 1; height: 60px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: all 0.1s; position: relative; overflow: hidden;
        }
        .choice-btn:active { transform: scale(0.95); }
        .choice-btn.left { border-bottom: 4px solid var(--danger); }
        .choice-btn.right { border-bottom: 4px solid var(--primary); }
        .choice-btn .label { font-size: 10px; opacity: 0.7; text-transform: uppercase; letter-spacing: 1px; }
        .choice-btn .main-text { font-size: 14px; font-weight: 800; line-height: 1.1; text-align: center; }
        
        /* STATS BARS */
        .stat-bar-container { height: 6px; background: #222; width: 100%; border-radius: 3px; overflow: hidden; margin-top: 4px; }
        .stat-bar { height: 100%; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body>
    <div id="loader" class="fixed inset-0 bg-black z-[100] flex items-center justify-center text-green-500 font-mono text-xs">INITIALIZING CORE...</div>
    
    <canvas id="matrix"></canvas>
    <div class="scanlines"></div>

    <div id="app" v-cloak class="h-screen flex flex-col relative z-10">
        
        <!-- MENU -->
        <transition name="fade">
            <div v-if="screen === 'menu'" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-black/90 p-6 backdrop-blur-sm">
                <h1 class="text-5xl font-black text-white mb-2 tracking-tighter text-center">ETHOS: <span class="text-[#00ff9d]">CORE</span></h1>
                <p class="text-xs text-gray-400 mb-10 tracking-[0.5em] uppercase">–°–ò–ú–£–õ–Ø–¢–û–† –ü–†–ê–í–ò–¢–ï–õ–Ø</p>
                
                <div class="w-full max-w-xs space-y-4">
                    <div class="flex justify-between items-center bg-[#111] p-3 rounded border border-[#333]">
                        <span class="text-yellow-500">–ë–ê–õ–ê–ù–°:</span>
                        <span class="font-bold font-mono text-xl">{{ bits }} ‡∏ø</span>
                    </div>
                    <button @click="startGame" class="cyber-btn w-full py-5 text-lg">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
                    <div class="grid grid-cols-2 gap-3">
                        <button @click="screen='shop'" class="cyber-btn bg-[#00d2ff] py-3 text-sm">–†–´–ù–û–ö</button>
                        <button @click="screen='info'" class="cyber-btn bg-white py-3 text-sm">–ò–ù–§–û</button>
                    </div>
                    <div class="text-center mt-4 text-[10px] text-gray-600">–†–ï–ö–û–†–î: {{ highScore }} –î–ù–ï–ô</div>
                </div>
            </div>
        </transition>

        <!-- GAME INTERFACE -->
        <div v-if="screen === 'game'" class="flex-1 flex flex-col relative overflow-hidden">
            
            <!-- HEADER STATS -->
            <div class="px-4 py-3 bg-black/80 border-b border-white/10 grid grid-cols-4 gap-3 shrink-0 z-30">
                <div v-for="(val, key) in stats" :key="key" class="flex flex-col items-center">
                    <span class="text-lg mb-1">{{ icons[key] }}</span>
                    <div class="stat-bar-container">
                        <div class="stat-bar" :class="getBarColor(val)" :style="{width: val + '%'}"></div>
                    </div>
                    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤–ª–∏—è–Ω–∏—è (—Å—Ç—Ä–µ–ª–æ—á–∫–∏) -->
                    <div v-if="upgrades.lens && activeScenario" class="h-3 flex justify-center w-full">
                         <span v-if="getImpact(key) > 0" class="text-[10px] text-green-500 font-bold">‚ñ≤</span>
                         <span v-if="getImpact(key) < 0" class="text-[10px] text-red-500 font-bold">‚ñº</span>
                    </div>
                </div>
            </div>

            <!-- CARD AREA -->
            <div class="flex-1 relative flex items-center justify-center px-4">
                
                <!-- Alert Messages -->
                <div v-if="deathReason" class="absolute z-[60] bg-red-600 text-white p-4 text-center font-black text-lg border-4 border-white rotate-[-2deg] shadow-2xl uppercase">
                    {{ deathReason }}
                </div>

                <div v-if="activeScenario" class="game-card" :style="cardStyle">
                    <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞/–≠–º–æ–¥–∑–∏ -->
                    <div class="h-3/5 bg-[#1a1a1a] flex items-center justify-center relative border-b border-[#333] overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                        <div class="text-[8rem] filter drop-shadow-2xl scale-110">{{ activeScenario.emoji }}</div>
                        <div class="absolute top-3 right-3 bg-black/70 px-2 py-1 rounded text-[10px] font-mono text-gray-400 border border-gray-800">
                            –î–ï–ù–¨ {{ moves }}
                        </div>
                    </div>
                    
                    <!-- –¢–µ–∫—Å—Ç -->
                    <div class="h-2/5 p-5 flex flex-col items-center text-center relative bg-[#111]">
                        <h3 class="text-xl font-bold text-white mb-2 leading-tight uppercase text-[#00ff9d]">{{ activeScenario.title }}</h3>
                        <p class="text-sm text-gray-300 font-mono leading-relaxed">{{ activeScenario.desc }}</p>
                    </div>
                </div>
            </div>

            <!-- BUTTONS AREA -->
            <div v-if="activeScenario && !deathReason" class="decision-panel pb-8">
                <button @click="makeChoice('left')" class="choice-btn left active:bg-red-900/30">
                    <span class="text-2xl mb-1 text-red-500">‚úï</span>
                    <span class="main-text text-red-100">{{ activeScenario.left.text }}</span>
                </button>
                
                <button @click="makeChoice('right')" class="choice-btn right active:bg-green-900/30">
                    <span class="text-2xl mb-1 text-green-500">‚úì</span>
                    <span class="main-text text-green-100">{{ activeScenario.right.text }}</span>
                </button>
            </div>
        </div>

        <!-- SHOP SCREEN -->
        <div v-if="screen === 'shop'" class="absolute inset-0 z-50 bg-black flex flex-col">
            <div class="p-4 border-b border-gray-800 flex justify-between items-center">
                <h2 class="text-xl font-bold text-yellow-500">–†–´–ù–û–ö ({{ bits }} ‡∏ø)</h2>
                <button @click="screen='menu'" class="text-xs border border-gray-600 px-3 py-1 rounded">–ù–ê–ó–ê–î</button>
            </div>
            <div class="p-4 space-y-3 overflow-y-auto">
                <div v-for="item in shopItems" :key="item.id" class="border border-gray-700 bg-gray-900 p-3 rounded flex justify-between items-center">
                    <div>
                        <div class="font-bold text-sm">{{ item.icon }} {{ item.name }}</div>
                        <div class="text-[10px] text-gray-500">{{ item.desc }}</div>
                    </div>
                    <button v-if="!upgrades[item.id]" @click="buyItem(item)" :disabled="bits < item.price" class="bg-yellow-500 text-black px-3 py-1 text-xs font-bold rounded disabled:opacity-30">
                        {{ item.price }} ‡∏ø
                    </button>
                    <div v-else class="text-green-500 text-xs font-bold border border-green-500 px-2 py-1 rounded">–ö–£–ü–õ–ï–ù–û</div>
                </div>
            </div>
        </div>

        <!-- GAME OVER -->
        <div v-if="screen === 'end'" class="absolute inset-0 z-[100] bg-red-950/95 backdrop-blur flex flex-col items-center justify-center p-8 text-center">
            <div class="text-6xl mb-4">‚ò†Ô∏è</div>
            <h2 class="text-3xl font-black uppercase mb-2">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h2>
            <p class="text-sm text-red-200 mb-6 font-mono border border-red-500/50 bg-red-500/20 p-3">{{ deathReason }}</p>
            <div class="mb-8 text-xl font-mono">
                <div>–î–ù–ï–ô: {{ moves }}</div>
                <div class="text-yellow-400 text-sm">+{{ earnedBits }} ‡∏ø –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
            </div>
            <button @click="screen='menu'" class="cyber-btn w-full py-4 text-lg uppercase">–í –ú–ï–ù–Æ</button>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        const tg = window.Telegram?.WebApp;

        // --- –ì–ò–ì–ê–ù–¢–°–ö–ò–ô –°–ü–ò–°–û–ö –°–¶–ï–ù–ê–†–ò–ï–í (60+) ---
        const CARDS_POOL = [
            // --- –ü–û–õ–ò–¢–ò–ö–ê –ò –û–ë–©–ï–°–¢–í–û ---
            { emoji:'üó≥Ô∏è', title:'–í–´–ë–û–†–´', desc:'–û–ø–ø–æ–∑–∏—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç —á–µ—Å—Ç–Ω–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞.', left:{text:'–ü–û–î–¢–ê–°–û–í–ê–¢–¨', s:{pop:-15, sec:10, mor:-10}}, right:{text:'–ß–ï–°–¢–ù–û', s:{pop:10, sec:-10, fin:-5}} },
            { emoji:'üì¢', title:'–ü–†–û–ü–ê–ì–ê–ù–î–ê', desc:'–£—Å–∏–ª–∏—Ç—å –≤–µ—â–∞–Ω–∏–µ –Ω–∞ –¢–í?', left:{text:'–ù–ï–¢', s:{fin:5, pop:5}}, right:{text:'–ó–û–ú–ë–ò–†–û–í–ê–¢–¨', s:{fin:-10, pop:-10, sec:15, mor:-5}} },
            { emoji:'ü•ñ', title:'–¶–ï–ù–´ –ù–ê –•–õ–ï–ë', desc:'–ù–∞—Ä–æ–¥ –≥–æ–ª–æ–¥–∞–µ—Ç. –í–≤–µ—Å—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–Ω?', left:{text:'–†–´–ù–û–ö', s:{pop:-20, fin:10}}, right:{text:'–ö–û–ù–¢–†–û–õ–¨', s:{pop:15, fin:-15, mor:5}} },
            { emoji:'üè∞', title:'–î–í–û–†–ï–¶', desc:'–ü–æ—Å—Ç—Ä–æ–∏—Ç—å —Å–µ–±–µ –Ω–æ–≤—É—é —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏—é?', left:{text:'–°–ö–†–û–ú–ù–û–°–¢–¨', s:{fin:10, pop:5}}, right:{text:'–†–û–°–ö–û–®–¨', s:{fin:-25, pop:-15, sec:5}} },
            { emoji:'üõÇ', title:'–ì–†–ê–ù–ò–¶–´', desc:'–ë–µ–∂–µ–Ω—Ü—ã –ø—Ä–æ—Å—è—Ç —É–±–µ–∂–∏—â–∞.', left:{text:'–ó–ê–ö–†–´–¢–¨', s:{sec:10, mor:-15}}, right:{text:'–ü–†–ò–ù–Ø–¢–¨', s:{pop:5, fin:-15, mor:15}} },
            { emoji:'‚öñÔ∏è', title:'–°–£–î–¨–Ø', desc:'–ü–æ—Å–∞–¥–∏—Ç—å –≤–∞—à–µ–≥–æ –¥—Ä—É–≥–∞-–∫–æ—Ä—Ä—É–ø—Ü–∏–æ–Ω–µ—Ä–∞?', left:{text:'–ü–û–ú–ò–õ–û–í–ê–¢–¨', s:{mor:-25, sec:10}}, right:{text:'–ü–û–°–ê–î–ò–¢–¨', s:{mor:15, sec:-10}} },
            { emoji:'ü¶†', title:'–í–ò–†–£–°', desc:'–ù–æ–≤—ã–π —à—Ç–∞–º–º –≥—Ä–∏–ø–ø–∞.', left:{text:'–ò–ì–ù–û–†–ò–†–û–í–ê–¢–¨', s:{pop:-20, fin:10}}, right:{text:'–õ–û–ö–î–ê–£–ù', s:{fin:-25, pop:5}} },
            { emoji:'üë¥', title:'–ü–ï–ù–°–ò–ò', desc:'–ö–∞–∑–Ω–∞ –ø—É—Å—Ç–∞. –û—Ç–º–µ–Ω–∏—Ç–µ –ø–µ–Ω—Å–∏–∏?', left:{text:'–°–û–•–†–ê–ù–ò–¢–¨', s:{fin:-20, pop:10}}, right:{text:'–û–¢–ú–ï–ù–ò–¢–¨', s:{fin:25, pop:-30, mor:-20}} },

            // --- –≠–ö–û–ù–û–ú–ò–ö–ê ---
            { emoji:'üìâ', title:'–ö–†–ò–ó–ò–°', desc:'–ë–∏—Ä–∂–∞ —Ä—É—Ö–Ω—É–ª–∞. –°–ø–∞—Å–∞–µ–º –±–∞–Ω–∫–∏?', left:{text:'–ü–£–°–¢–¨ –ì–û–†–Ø–¢', s:{fin:10, pop:-10}}, right:{text:'–°–ü–ê–°–¢–ò', s:{fin:-25, sec:5}} },
            { emoji:'üõ¢Ô∏è', title:'–ù–ï–§–¢–¨', desc:'–ù–∞—à–ª–∏ –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–µ –ø–æ–¥ –ø–∞—Ä–∫–æ–º.', left:{text:'–ü–ê–†–ö', s:{pop:10, fin:-10}}, right:{text:'–ë–£–†–ò–¢–¨', s:{fin:30, pop:-15, mor:-10}} },
            { emoji:'üè≠', title:'–ó–ê–í–û–î', desc:'–ó–∞–≤–æ–¥ –∑–∞–≥—Ä—è–∑–Ω—è–µ—Ç —Ä–µ–∫—É, –Ω–æ –¥–∞–µ—Ç —Ä–∞–±–æ—Ç—É.', left:{text:'–ó–ê–ö–†–´–¢–¨', s:{pop:-15, mor:15}}, right:{text:'–†–ê–ë–û–¢–ê–¢–¨', s:{fin:10, mor:-20}} },
            { emoji:'ü§ù', title:'–û–õ–ò–ì–ê–†–•–ò', desc:'–ü—Ä–æ—Å—è—Ç –Ω–∞–ª–æ–≥–æ–≤—ã–µ –ª—å–≥–æ—Ç—ã.', left:{text:'–û–¢–ö–ê–ó–ê–¢–¨', s:{fin:10, sec:-10}}, right:{text:'–î–ê–¢–¨', s:{fin:-10, sec:15, pop:-10}} },
            { emoji:'üí∞', title:'–ò–ù–í–ï–°–¢–û–†', desc:'–ò–Ω–æ—Å—Ç—Ä–∞–Ω—Ü—ã —Ö–æ—Ç—è—Ç –∫—É–ø–∏—Ç—å –ø–æ—Ä—Ç.', left:{text:'–ü–†–û–î–ê–¢–¨', s:{fin:25, sec:-15}}, right:{text:'–ù–ê–®–ï!', s:{fin:-5, sec:5}} },
            { emoji:'üí≥', title:'–¶–ò–§–†–û–í–û–ô –†–£–ë–õ–¨', desc:'–û—Ç–º–µ–Ω–∏—Ç—å –Ω–∞–ª–∏—á–Ω—ã–µ –¥–µ–Ω—å–≥–∏?', left:{text:'–û–°–¢–ê–í–ò–¢–¨', s:{pop:5}}, right:{text:'–û–¢–ú–ï–ù–ò–¢–¨', s:{sec:20, pop:-15, mor:-5}} },

            // --- –°–ò–õ–û–í–´–ï ---
            { emoji:'üëÆ', title:'–ü–û–õ–ò–¶–ò–Ø', desc:'–¢—Ä–µ–±—É—é—Ç –ø–æ–≤—ã—à–µ–Ω–∏—è –∑–∞—Ä–ø–ª–∞—Ç.', left:{text:'–û–ë–û–ô–î–£–¢–°–Ø', s:{sec:-20, fin:10}}, right:{text:'–ü–õ–ê–¢–ò–¢–¨', s:{sec:15, fin:-15}} },
            { emoji:'üî´', title:'–û–†–£–ñ–ò–ï', desc:'–†–∞–∑—Ä–µ—à–∏—Ç—å –≥—Ä–∞–∂–¥–∞–Ω–∞–º –Ω–æ—Å–∏—Ç—å –æ—Ä—É–∂–∏–µ?', left:{text:'–ó–ê–ü–†–ï–¢', s:{sec:5, pop:-5}}, right:{text:'–†–ê–ó–†–ï–®–ò–¢–¨', s:{sec:-10, pop:10, mor:-5}} },
            { emoji:'üïµÔ∏è', title:'–°–õ–ï–ñ–ö–ê', desc:'–ß–∏—Ç–∞—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –≥—Ä–∞–∂–¥–∞–Ω?', left:{text:'–ü–†–ò–í–ê–¢–ù–û–°–¢–¨', s:{pop:10, sec:-15}}, right:{text:'–ß–ò–¢–ê–¢–¨', s:{sec:20, pop:-15, mor:-10}} },
            { emoji:'ü™ñ', title:'–í–û–ô–ù–ê', desc:'–°–æ—Å–µ–¥–∏ —Å—Ç—è–≥–∏–≤–∞—é—Ç –≤–æ–π—Å–∫–∞.', left:{text:'–î–ò–ü–õ–û–ú–ê–¢–ò–Ø', s:{sec:-10, fin:5}}, right:{text:'–ú–û–ë–ò–õ–ò–ó–ê–¶–ò–Ø', s:{sec:25, fin:-25, pop:-15}} },
            { emoji:'üöÅ', title:'–î–†–û–ù–´', desc:'–ó–∞–∫—É–ø–∏—Ç—å –±–æ–µ–≤—ã—Ö –¥—Ä–æ–Ω–æ–≤?', left:{text:'–î–û–†–û–ì–û', s:{fin:5}}, right:{text:'–ö–£–ü–ò–¢–¨', s:{fin:-20, sec:15}} },

            // --- –ö–ò–ë–ï–†–ü–ê–ù–ö / –ë–£–î–£–©–ï–ï ---
            { emoji:'ü§ñ', title:'–ò–ò-–ß–ò–ù–û–í–ù–ò–ö', desc:'–ó–∞–º–µ–Ω–∏—Ç—å –±—é—Ä–æ–∫—Ä–∞—Ç–æ–≤ –Ω–∞ –ò–ò?', left:{text:'–õ–Æ–î–ò', s:{fin:-10, mor:5}}, right:{text:'–ê–õ–ì–û–†–ò–¢–ú', s:{fin:20, mor:-10, pop:-5}} },
            { emoji:'üß¨', title:'–ì–ú–û-–õ–Æ–î–ò', desc:'–†–∞–∑—Ä–µ—à–∏—Ç—å –≥–µ–Ω–Ω—É—é –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–µ—Ç–µ–π?', left:{text:'–≠–¢–û –ì–†–ï–•', s:{mor:15, pop:-5}}, right:{text:'–≠–í–û–õ–Æ–¶–ò–Ø', s:{mor:-20, pop:5, fin:10}} },
            { emoji:'üß†', title:'–ù–ï–ô–†–û–õ–ò–ù–ö', desc:'–ß–∏–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏–µ?', left:{text:'–°–í–û–ë–û–î–ê', s:{pop:10, sec:-5}}, right:{text:'–ö–û–ù–¢–†–û–õ–¨', s:{sec:30, pop:-20, mor:-15}} },
            { emoji:'üëÅÔ∏è', title:'–£–ú–ù–´–ï –ö–ê–ú–ï–†–´', desc:'–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ª–∏—Ü –≤–µ–∑–¥–µ?', left:{text:'–ù–ï–¢', s:{sec:-10}}, right:{text:'–°–¢–ê–í–ò–¢–¨', s:{sec:15, pop:-10}} },
            { emoji:'‚òÅÔ∏è', title:'–°–ï–†–í–ï–†–ê', desc:'–•—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π?', left:{text:'–ó–ê–ü–†–ï–¢–ò–¢–¨', s:{sec:10, fin:-10}}, right:{text:'–†–ê–ó–†–ï–®–ò–¢–¨', s:{fin:10, sec:-15}} },

            // --- –ê–ë–°–£–†–î –ò –°–õ–£–ß–ê–ô–ù–û–°–¢–ò ---
            { emoji:'üê±', title:'–ö–û–¢-–ú–≠–†', desc:'–ù–∞—Ä–æ–¥ —Ö–æ—á–µ—Ç –∏–∑–±—Ä–∞—Ç—å –∫–æ—Ç–∞ –º—ç—Ä–æ–º.', left:{text:'–ë–†–ï–î', s:{pop:-10}}, right:{text:'–ú–Ø–£!', s:{pop:15, mor:10, sec:-5}} },
            { emoji:'üëΩ', title:'–ù–õ–û', desc:'–ü—Ä–∏—à–µ–ª—å—Ü—ã —Ç—Ä–µ–±—É—é—Ç —Ä–µ—Å—É—Ä—Å—ã.', left:{text:'–ê–¢–ê–ö–ê', s:{sec:-30, pop:-10}}, right:{text:'–î–ê–¢–¨', s:{fin:-30, pop:5}} },
            { emoji:'meteor', title:'METEORIT', desc:'–õ–µ—Ç–∏—Ç –Ω–∞ –≥–æ—Ä–æ–¥. –°–±–∏—Ç—å?', left:{text:'–ú–û–õ–ò–¢–¨–°–Ø', s:{mor:20, pop:-30}}, right:{text:'–†–ê–ö–ï–¢–û–ô', s:{fin:-25, sec:5, pop:10}} },
            { emoji:'üßü', title:'–ó–û–ú–ë–ò', desc:'–°—Ç—Ä–∞–Ω–Ω—ã–π –≤–∏—Ä—É—Å –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏.', left:{text:'–°–ñ–ï–ß–¨ –í–°–ï', s:{pop:-20, sec:10}}, right:{text:'–ò–ó–£–ß–ò–¢–¨', s:{sec:-20, fin:10}} },
            { emoji:'üöΩ', title:'–ó–û–õ–û–¢–û–ô –£–ù–ò–¢–ê–ó', desc:'–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç —à–µ–π—Ö–∞. –ü—Ä–∏–Ω—è—Ç—å?', left:{text:'–í –ú–£–ó–ï–ô', s:{fin:5, pop:5}}, right:{text:'–ú–ù–ï', s:{mor:-15, pop:-10}} },
            
            // --- –†–ï–õ–ò–ì–ò–Ø –ò –ú–û–†–ê–õ–¨ ---
            { emoji:'‚õ™', title:'–¶–ï–†–ö–û–í–¨', desc:'–ü—Ä–æ—Å—è—Ç –∑–µ–º–ª—é –ø–æ–¥ —Ö—Ä–∞–º –≤ —Ü–µ–Ω—Ç—Ä–µ.', left:{text:'–ü–ê–†–ö', s:{pop:5, mor:-10}}, right:{text:'–°–¢–†–û–ò–¢–¨', s:{mor:15, pop:-5, fin:-5}} },
            { emoji:'üé®', title:'–ò–°–ö–£–°–°–¢–í–û', desc:'–°—Ç—Ä–∞–Ω–Ω–∞—è –≤—ã—Å—Ç–∞–≤–∫–∞ –≤–æ–∑–º—É—Ç–∏–ª–∞ –≤–µ—Ä—É—é—â–∏—Ö.', left:{text:'–ó–ê–ö–†–´–¢–¨', s:{mor:10, pop:-5}}, right:{text:'–°–í–û–ë–û–î–ê', s:{mor:-15, pop:5}} },
            { emoji:'üè≥Ô∏è‚Äçüåà', title:'–ü–ê–†–ê–î', desc:'–ú–µ–Ω—å—à–∏–Ω—Å—Ç–≤–∞ —Ö–æ—Ç—è—Ç –ø—Ä–æ–≤–µ—Å—Ç–∏ –º–∞—Ä—à.', left:{text:'–ó–ê–ü–†–ï–¢–ò–¢–¨', s:{mor:10, pop:-10}}, right:{text:'–†–ê–ó–†–ï–®–ò–¢–¨', s:{mor:-15, pop:5}} },

            // --- –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò ---
            { emoji:'‚ò¢Ô∏è', title:'–ê–¢–û–ú–ù–ê–Ø –ê–≠–°', desc:'–°—Ç—Ä–æ–∏–º –Ω–æ–≤—É—é —Å—Ç–∞–Ω—Ü–∏—é?', left:{text:'–û–ü–ê–°–ù–û', s:{fin:-10}}, right:{text:'–≠–ù–ï–†–ì–ò–Ø', s:{fin:20, pop:-10, sec:-5}} },
            { emoji:'üåä', title:'–ù–ê–í–û–î–ù–ï–ù–ò–ï', desc:'–î–∞–º–±—É –ø—Ä–æ—Ä—ã–≤–∞–µ—Ç.', left:{text:'–≠–í–ê–ö–£–ê–¶–ò–Ø', s:{fin:-15, pop:5}}, right:{text:'–ó–ê–¢–ö–ù–£–¢–¨', s:{sec:-10, pop:-10}} },
            { emoji:'üéì', title:'–£–ß–ï–ù–´–ï', desc:'–£–µ–∑–∂–∞—é—Ç –∏–∑ —Å—Ç—Ä–∞–Ω—ã.', left:{text:'–ü–£–°–¢–¨ –í–ê–õ–Ø–¢', s:{fin:5, sec:-5}}, right:{text:'–ì–†–ê–ù–¢–´', s:{fin:-15, sec:5}} },
            { emoji:'‚öΩ', title:'–§–£–¢–ë–û–õ', desc:'–ü—Ä–æ–≤–µ—Å—Ç–∏ —á–µ–º–ø–∏–æ–Ω–∞—Ç –º–∏—Ä–∞?', left:{text:'–î–û–†–û–ì–û', s:{fin:10}}, right:{text:'–ü–†–ê–ó–î–ù–ò–ö', s:{fin:-30, pop:20, mor:5}} },
            { emoji:'üì±', title:'–ë–õ–û–ö–ò–†–û–í–ö–ê', desc:'–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä?', left:{text:'–ù–ï–¢', s:{pop:5}}, right:{text:'–ë–ê–ù', s:{sec:10, pop:-20, mor:-5}} },
            { emoji:'üå≤', title:'–õ–ï–°', desc:'–ö–∏—Ç–∞–π—Ü—ã —Ö–æ—Ç—è—Ç –∫—É–ø–∏—Ç—å –ª–µ—Å.', left:{text:'–ü–†–û–î–ê–¢–¨', s:{fin:20, mor:-10}}, right:{text:'–ó–ê–ü–†–ï–¢', s:{fin:-5, mor:10}} },
            { emoji:'üé∞', title:'–ö–ê–ó–ò–ù–û', desc:'–õ–µ–≥–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–∑–∞—Ä—Ç–Ω—ã–µ –∏–≥—Ä—ã?', left:{text:'–ì–†–ï–•', s:{mor:10, fin:-5}}, right:{text:'–ù–ê–õ–û–ì–ò', s:{fin:25, mor:-20}} },
            { emoji:'üöÄ', title:'–ö–û–°–ú–û–°', desc:'–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–ø—É—Ç–Ω–∏–∫-—à–ø–∏–æ–Ω?', left:{text:'–ù–ê–£–ö–ê', s:{fin:-10, pop:5}}, right:{text:'–®–ü–ò–û–ù–ê–ñ', s:{fin:-20, sec:20}} },
            { emoji:'üíä', title:'–õ–ï–ö–ê–†–°–¢–í–û', desc:'–ò–∑–æ–±—Ä–µ–ª–∏ —Ç–∞–±–ª–µ—Ç–∫—É –æ—Ç —Å—Ç–∞—Ä–æ—Å—Ç–∏ (–¥–æ—Ä–æ–≥–æ).', left:{text:'–î–õ–Ø –≠–õ–ò–¢–´', s:{fin:20, pop:-20}}, right:{text:'–í–°–ï–ú', s:{fin:-40, pop:20}} },
            { emoji:'üé™', title:'–¶–ò–†–ö', desc:'–ó–∞–ø—Ä–µ—Ç–∏—Ç—å –∂–∏–≤–æ—Ç–Ω—ã—Ö –≤ —Ü–∏—Ä–∫–µ?', left:{text:'–¢–†–ê–î–ò–¶–ò–Ø', s:{mor:-5}}, right:{text:'–ì–£–ú–ê–ù–ù–û–°–¢–¨', s:{mor:10, fin:-5}} },
            { emoji:'üö¨', title:'–¢–ê–ë–ê–ö', desc:'–ü–æ–¥–Ω—è—Ç—å —Ü–µ–Ω—ã –Ω–∞ —Å–∏–≥–∞—Ä–µ—Ç—ã?', left:{text:'–ù–ï–¢', s:{pop:5}}, right:{text:'–ó–î–û–†–û–í–¨–ï', s:{pop:-10, fin:10}} },
            { emoji:'üöú', title:'–£–†–û–ñ–ê–ô', desc:'–ó–∞—Å—É—Ö–∞ —É–Ω–∏—á—Ç–æ–∂–∏–ª–∞ –ø–æ—Å–µ–≤—ã.', left:{text:'–ö–£–ü–ò–¢–¨', s:{fin:-20, pop:5}}, right:{text:'–ì–û–õ–û–î', s:{pop:-25, fin:5}} },
            { emoji:'üö¶', title:'–ü–†–û–ë–ö–ò', desc:'–í–≤–µ—Å—Ç–∏ –ø–ª–∞—Ç–Ω—ã–π –≤—ä–µ–∑–¥ –≤ —Ü–µ–Ω—Ç—Ä?', left:{text:'–ë–ï–°–ü–õ–ê–¢–ù–û', s:{pop:5, fin:-5}}, right:{text:'–ü–õ–ê–¢–ù–û', s:{pop:-15, fin:10}} },
            { emoji:'üìö', title:'–ò–°–¢–û–†–ò–Ø', desc:'–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —É—á–µ–±–Ω–∏–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏?', left:{text:'–ü–†–ê–í–î–ê', s:{mor:5, sec:-5}}, right:{text:'–ü–ê–¢–†–ò–û–¢–ò–ó–ú', s:{mor:-10, sec:10}} },
            { emoji:'üóëÔ∏è', title:'–ú–£–°–û–†', desc:'–°—Ç—Ä–æ–∏—Ç—å —Å–≤–∞–ª–∫—É –≤–æ–∑–ª–µ –≥–æ—Ä–æ–¥–∞?', left:{text:'–î–ê–õ–ï–ö–û', s:{fin:-15, pop:5}}, right:{text:'–†–Ø–î–û–ú', s:{fin:5, pop:-20}} },
            { emoji:'üëª', title:'–ü–†–ò–ó–†–ê–ö', desc:'–ì–æ–≤–æ—Ä—è—Ç, –≤ –º–µ—Ç—Ä–æ –≤–∏–¥–µ–ª–∏ –ø—Ä–∏–∑—Ä–∞–∫–∞.', left:{text:'–ë–†–ï–î', s:{mor:5}}, right:{text:'–û–•–û–¢–ù–ò–ö–ò', s:{fin:-5, pop:5}} },
            { emoji:'üêÄ', title:'–ö–†–´–°–´', desc:'–ù–∞—à–µ—Å—Ç–≤–∏–µ –≥—Ä—ã–∑—É–Ω–æ–≤.', left:{text:'–Ø–î', s:{pop:-5}}, right:{text:'–°–≠–°', s:{fin:-10, pop:5}} },
            { emoji:'‚ö°', title:'–°–í–ï–¢', desc:'–í–µ–µ—Ä–Ω—ã–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–∞.', left:{text:'–¢–ï–†–ü–ï–¢–¨', s:{pop:-15}}, right:{text:'–ö–£–ü–ò–¢–¨', s:{fin:-20, pop:5}} }
        ];

        createApp({
            setup() {
                const screen = ref('menu');
                const bits = ref(parseInt(localStorage.getItem('ec_bits') || 0));
                const upgrades = ref(JSON.parse(localStorage.getItem('ec_upgrades') || '{}'));
                const highScore = ref(parseInt(localStorage.getItem('ec_score') || 0));
                
                const stats = ref({ pop: 50, fin: 50, sec: 50, mor: 50 });
                const icons = { pop:'üë•', fin:'üí∞', sec:'üõ°Ô∏è', mor:'‚öñÔ∏è' };
                
                const moves = ref(0);
                const activeScenario = ref(null);
                const deathReason = ref(null);
                const earnedBits = ref(0);
                const flyDir = ref(null);

                const shopItems = [
                    { id: 'lens', name: '–õ–ò–ù–ó–ê –ü–†–ê–í–î–´', icon: 'üëÅÔ∏è', desc: '–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–ª–∏—è–Ω–∏–µ –≤—ã–±–æ—Ä–∞', price: 100 },
                    { id: 'shield', name: '–ê–í–¢–û-–©–ò–¢', icon: 'üõ°Ô∏è', desc: '–°–ø–∞—Å–∞–µ—Ç –æ—Ç –æ–¥–Ω–æ–π —Å–º–µ—Ä—Ç–∏', price: 300 },
                    { id: 'coin', name: '–ú–ê–ô–ù–ï–†', icon: '‚õèÔ∏è', desc: 'x2 –¥–æ—Ö–æ–¥ –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å', price: 500 }
                ];

                onMounted(() => {
                    document.getElementById('loader').style.display = 'none';
                    initMatrix();
                    if(tg) { tg.ready(); tg.expand(); tg.setHeaderColor('#000000'); }
                });

                const cardStyle = computed(() => {
                    if(!flyDir.value) return {};
                    const rot = flyDir.value === 'right' ? 20 : -20;
                    const x = flyDir.value === 'right' ? 400 : -400;
                    return { transform: `translate(${x}px, 50px) rotate(${rot}deg)`, opacity: 0 };
                });

                const startGame = () => {
                    stats.value = { pop: 50, fin: 50, sec: 50, mor: 50 };
                    moves.value = 0;
                    deathReason.value = null;
                    pickCard();
                    screen.value = 'game';
                };

                const pickCard = () => {
                    flyDir.value = null;
                    // –ë–µ—Ä–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∫–∞—Ä—Ç—É –∏–∑ –ø—É–ª–∞
                    const rand = Math.floor(Math.random() * CARDS_POOL.length);
                    activeScenario.value = CARDS_POOL[rand];
                };

                const makeChoice = (dir) => {
                    if(flyDir.value || deathReason.value) return;
                    
                    // Haptic feedback
                    if(tg) tg.HapticFeedback.impactOccurred('medium');

                    const impacts = activeScenario.value[dir].s;
                    flyDir.value = dir;

                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∞—Ç—ã
                    for(let k in impacts) {
                        stats.value[k] = Math.min(100, Math.max(0, stats.value[k] + impacts[k]));
                    }

                    moves.value++;

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ—Ä—Ç–∏
                    setTimeout(() => {
                        const death = checkDeath();
                        if(death) {
                            if(upgrades.value.shield) {
                                // Use shield
                                upgrades.value.shield = false;
                                saveData();
                                stats.value = { pop: 50, fin: 50, sec: 50, mor: 50 };
                                if(tg) tg.showPopup({title:'–©–ò–¢', message:'–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ-–∑–∞—â–∏—Ç—ã —Å–ø–∞—Å–ª–∞ –≤–∞—Å –æ—Ç –∫—Ä–∞—Ö–∞.'});
                                pickCard();
                            } else {
                                // Die
                                deathReason.value = death;
                                if(tg) tg.HapticFeedback.notificationOccurred('error');
                                
                                let earned = moves.value * 5;
                                if(upgrades.value.coin) earned *= 2;
                                earnedBits.value = earned;
                                bits.value += earned;
                                if(moves.value > highScore.value) highScore.value = moves.value;
                                saveData();
                                setTimeout(() => screen.value = 'end', 1500);
                            }
                        } else {
                            pickCard();
                        }
                    }, 200);
                };

                const checkDeath = () => {
                    const s = stats.value;
                    if(s.pop <= 0) return "–°–í–ï–†–ì–ù–£–¢ –ù–ê–†–û–î–û–ú";
                    if(s.pop >= 100) return "–•–ê–û–° –ê–ù–ê–†–•–ò–ò";
                    if(s.fin <= 0) return "–ë–ê–ù–ö–†–û–¢–°–¢–í–û";
                    if(s.fin >= 100) return "–£–ë–ò–¢ –û–õ–ò–ì–ê–†–•–ê–ú–ò";
                    if(s.sec <= 0) return "–í–¢–û–†–ñ–ï–ù–ò–ï –í–†–ê–ì–ê";
                    if(s.sec >= 100) return "–í–û–ï–ù–ù–´–ô –ü–ï–†–ï–í–û–†–û–¢";
                    if(s.mor <= 0) return "–ü–û–õ–ù–ê–Ø –ê–ú–û–†–ê–õ–¨–ù–û–°–¢–¨";
                    if(s.mor >= 100) return "–†–ï–õ–ò–ì–ò–û–ó–ù–´–ô –§–ê–ù–ê–¢–ò–ó–ú";
                    return null;
                };

                const buyItem = (item) => {
                    if(bits.value >= item.price) {
                        bits.value -= item.price;
                        upgrades.value[item.id] = true;
                        saveData();
                        if(tg) tg.HapticFeedback.notificationOccurred('success');
                    }
                };

                const saveData = () => {
                    localStorage.setItem('ec_bits', bits.value);
                    localStorage.setItem('ec_upgrades', JSON.stringify(upgrades.value));
                    localStorage.setItem('ec_score', highScore.value);
                };

                const getBarColor = (v) => {
                    if(v < 20 || v > 80) return 'bg-red-500 shadow-[0_0_10px_red]';
                    return 'bg-[#00ff9d]';
                };

                // –î–ª—è –ª–∏–Ω–∑—ã –ø—Ä–∞–≤–¥—ã: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–ª–∏—è–Ω–∏–µ –ø—Ä–∞–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞
                const getImpact = (key) => {
                    if(!activeScenario.value) return 0;
                    return activeScenario.value.right.s[key] || 0;
                };

                return {
                    screen, bits, stats, icons, upgrades, shopItems, moves, activeScenario, cardStyle, deathReason, earnedBits, highScore,
                    startGame, makeChoice, buyItem, getBarColor, getImpact
                };
            }
        }).mount('#app');

        function initMatrix() {
            const c = document.getElementById('matrix');
            const ctx = c.getContext('2d');
            c.width = window.innerWidth; c.height = window.innerHeight;
            const drops = Array(Math.floor(c.width/20)).fill(1);
            function draw() {
                ctx.fillStyle = 'rgba(0,0,0,0.05)'; ctx.fillRect(0,0,c.width,c.height);
                ctx.fillStyle = '#0F0'; ctx.font = '15px monospace';
                for(let i=0; i<drops.length; i++) {
                    ctx.fillText(String.fromCharCode(0x30A0+Math.random()*96), i*20, drops[i]*20);
                    if(drops[i]*20>c.height && Math.random()>0.975) drops[i]=0;
                    drops[i]++;
                }
                requestAnimationFrame(draw);
            }
            draw();
        }
    </script>
</body>
</html>
