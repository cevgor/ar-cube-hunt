<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MORAL OS: RU EDITION</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;700;800&family=Russo+One&display=swap" rel="stylesheet">

    <style>
        :root { --bg: #050505; --primary: #00ff9d; --secondary: #00d2ff; --danger: #ff2a6d; --panel: rgba(10, 20, 30, 0.8); }
        body { background-color: var(--bg); color: #fff; font-family: 'JetBrains Mono', monospace; overflow: hidden; touch-action: none; margin: 0; }

        /* --- VISUAL FX --- */
        #matrix { position: fixed; top: 0; left: 0; z-index: 0; opacity: 0.15; }
        
        .overlay { position: fixed; inset: 0; z-index: 100; pointer-events: none; }
        .overlay::before { content: ''; position: absolute; inset: 0; background: radial-gradient(circle, transparent 50%, #000 150%); }
        .overlay::after { content: ''; position: absolute; inset: 0; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%); background-size: 100% 3px; }

        /* –ì–ª–∏—Ç—á –¢–µ–∫—Å—Ç */
        .glitch { position: relative; color: #fff; }
        .glitch::before, .glitch::after {
            content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg);
        }
        .glitch::before { left: 2px; text-shadow: -1px 0 var(--danger); clip-path: inset(0 0 0 0); animation: glitch-1 3s infinite linear alternate-reverse; }
        .glitch::after { left: -2px; text-shadow: -1px 0 var(--secondary); clip-path: inset(0 0 0 0); animation: glitch-2 2s infinite linear alternate-reverse; }
        @keyframes glitch-1 { 0% {clip-path: inset(20% 0 80% 0);} 20% {clip-path: inset(60% 0 10% 0);} 100% {clip-path: inset(10% 0 50% 0);} }
        @keyframes glitch-2 { 0% {clip-path: inset(10% 0 50% 0);} 20% {clip-path: inset(30% 0 20% 0);} 100% {clip-path: inset(80% 0 5% 0);} }

        /* –ö–Ω–æ–ø–∫–∞ */
        .cyber-btn {
            position: relative; clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            background: var(--primary); color: #000; transition: all 0.1s;
        }
        .cyber-btn:active { transform: scale(0.95); filter: brightness(0.8); }
        .cyber-btn::before {
            content: ''; position: absolute; inset: 0; background: linear-gradient(45deg, transparent 5%, rgba(255,255,255,0.5) 5%, transparent 10%);
            animation: shine 2s infinite;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ */
        .game-card {
            width: 90%; max-width: 360px; height: 55vh; background: #121212; border: 1px solid #333;
            border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.9);
            display: flex; flex-direction: column; overflow: hidden; position: absolute;
            transform-origin: 50% 150%; will-change: transform; z-index: 10;
        }
        .badge {
            position: absolute; top: 20px; padding: 8px 16px; border: 3px solid; border-radius: 6px;
            font-family: 'Russo One', sans-serif; font-size: 18px; opacity: 0; z-index: 20;
            background: rgba(0,0,0,0.8); text-transform: uppercase; white-space: nowrap;
        }

        [v-cloak] { display: none; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.5s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>
    <canvas id="matrix"></canvas>
    <div class="overlay"></div>

    <div id="app" v-cloak class="w-full h-screen flex flex-col relative z-10">
        
        <!-- 1. –ó–ê–ì–†–£–ó–ö–ê (BOOT) -->
        <transition name="fade">
            <div v-if="screen === 'boot'" class="absolute inset-0 bg-black z-50 flex flex-col justify-end p-8 font-mono text-xs md:text-sm text-green-500 leading-relaxed">
                <div v-for="line in bootLog" :key="line.id" class="mb-1">
                    <span class="text-slate-500">[{{ line.time }}]</span> <span v-html="line.text"></span>
                </div>
                <div v-if="bootFinished" class="mt-4 animate-pulse text-white text-center w-full uppercase">
                    –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                </div>
                <div class="absolute inset-0 z-10" @click="finishBoot" v-if="bootFinished"></div>
            </div>
        </transition>

        <!-- 2. –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
        <transition name="fade">
            <div v-if="screen === 'menu'" class="absolute inset-0 z-40 flex flex-col items-center justify-center p-6">
                <div class="mb-12 relative text-center">
                    <div class="text-5xl md:text-7xl font-black glitch tracking-tighter" data-text="MORAL OS">MORAL OS</div>
                    <div class="text-xs font-mono text-cyan-400 tracking-[0.3em] mt-2">–í–ï–†–°–ò–Ø 4.0 RU</div>
                </div>

                <div class="w-full max-w-xs space-y-4">
                    <button @click="goToCharSelect" class="cyber-btn w-full py-4 font-bold text-xl tracking-wider uppercase">
                        –ù–∞—á–∞—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é
                    </button>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-slate-900/80 border border-slate-700 p-3 rounded text-center">
                            <div class="text-[10px] text-slate-500 uppercase">–†–µ–∫–æ—Ä–¥ (—Ö–æ–¥–æ–≤)</div>
                            <div class="text-2xl text-white font-mono">{{ highScore }}</div>
                        </div>
                        <div class="bg-slate-900/80 border border-slate-700 p-3 rounded text-center cursor-pointer hover:bg-slate-800" @click="toggleAudio">
                            <div class="text-[10px] text-slate-500 uppercase">–ó–≤—É–∫</div>
                            <div class="text-2xl">{{ audioEnabled ? '–í–ö–õ' : '–í–´–ö–õ' }}</div>
                        </div>
                    </div>
                </div>
                
                <div class="absolute bottom-6 text-[10px] text-slate-600 font-mono">–°–û–ó–î–ê–ù–û –ù–ï–ô–†–û–°–ï–¢–¨–Æ</div>
            </div>
        </transition>

        <!-- 3. –í–´–ë–û–† –ü–ï–†–°–û–ù–ê–ñ–ê -->
        <transition name="fade">
            <div v-if="screen === 'char_select'" class="absolute inset-0 z-40 flex flex-col items-center justify-center p-6 bg-black/90">
                <h2 class="text-xl font-bold text-white mb-6 font-mono border-b border-slate-700 pb-2 w-full text-center">–í–´–ë–û–† –Ø–î–†–ê</h2>
                
                <div class="w-full max-w-sm space-y-4 mb-8">
                    <div v-for="char in characters" :key="char.id" 
                         @click="selectChar(char)"
                         class="relative p-4 border transition-all duration-300 cursor-pointer overflow-hidden group"
                         :class="[
                            char.id === selectedChar.id ? 'border-[#00ff9d] bg-[#00ff9d]/10' : 'border-slate-700 bg-slate-900/50',
                            !char.unlocked ? 'opacity-60 grayscale' : 'hover:border-white'
                         ]">
                        
                        <div v-if="char.id === selectedChar.id" class="absolute top-0 right-0 p-1 bg-[#00ff9d] text-black text-[10px] font-bold">–í–´–ë–†–ê–ù–û</div>

                        <div class="flex items-center gap-4">
                            <div class="text-4xl">{{ char.unlocked ? char.icon : 'üîí' }}</div>
                            <div class="flex-1">
                                <div class="font-bold text-white tracking-wide">{{ char.name }}</div>
                                <div class="text-xs text-slate-400 font-mono" v-if="char.unlocked">{{ char.desc }}</div>
                                <div class="text-xs text-red-400 font-mono" v-else>–£–°–õ–û–í–ò–ï: {{ char.condition }}</div>
                            </div>
                        </div>

                        <!-- –ú–∏–Ω–∏ —Å—Ç–∞—Ç—ã -->
                        <div v-if="char.unlocked" class="grid grid-cols-4 gap-1 mt-3 pt-3 border-t border-white/10">
                            <div v-for="(v, k) in char.stats" :key="k" class="h-1 bg-slate-700 rounded-full overflow-hidden">
                                <div class="h-full bg-white/50" :style="{width: v + '%'}"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex gap-4 w-full max-w-sm">
                    <button @click="screen = 'menu'" class="flex-1 py-3 border border-slate-600 text-slate-400 font-mono text-sm hover:bg-slate-800 uppercase">–ù–∞–∑–∞–¥</button>
                    <button @click="startGame" class="flex-[2] cyber-btn font-bold text-lg clip-path-polygon uppercase">
                        –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
                    </button>
                </div>
            </div>
        </transition>

        <!-- 4. –ò–ù–¢–ï–†–§–ï–ô–° –ò–ì–†–´ -->
        <div v-if="screen === 'playing'" class="w-full p-4 pt-6 grid grid-cols-4 gap-3 z-20">
            <div v-for="(val, key) in stats" :key="key" class="flex flex-col items-center group">
                <div class="text-lg mb-1 drop-shadow-[0_0_5px_rgba(255,255,255,0.5)] cursor-help">{{ getStatIcon(key) }}</div>
                <div class="h-24 w-2 bg-slate-800/50 rounded-full relative overflow-hidden border border-slate-600 backdrop-blur-sm">
                    <div class="absolute bottom-0 left-0 w-full transition-all duration-300"
                         :class="getBarColor(key, val)" :style="{ height: val + '%' }"></div>
                    <div v-if="val > 85" class="absolute top-0 w-full h-4 bg-red-500 animate-pulse"></div>
                    <div v-if="val < 15" class="absolute bottom-0 w-full h-4 bg-red-500 animate-pulse"></div>
                </div>
            </div>
        </div>

        <!-- 5. –ò–ì–†–û–í–û–ï –ü–û–õ–ï -->
        <div v-if="screen === 'playing'" class="flex-1 flex items-center justify-center relative z-10 perspective-[1000px]">
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Å–º–µ—Ä—Ç–∏ -->
            <div v-if="deathReason" class="absolute z-50 bg-red-600 text-white font-black text-lg p-4 border-4 border-white shadow-[0_0_30px_red] text-center max-w-xs animate-bounce rotate-[-3deg] uppercase">
                {{ deathReason }}
            </div>

            <!-- –ê–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ -->
            <div v-if="activeScenario" 
                 class="game-card"
                 :style="cardStyle"
                 @mousedown="startDrag" @touchstart="startDrag">
                
                <div class="badge" style="right: 20px; color: var(--danger); border-color: var(--danger); transform: rotate(15deg)" :style="{opacity: choiceOpacity.right}">{{ activeScenario.right.label }}</div>
                <div class="badge" style="left: 20px; color: var(--secondary); border-color: var(--secondary); transform: rotate(-15deg)" :style="{opacity: choiceOpacity.left}">{{ activeScenario.left.label }}</div>

                <div class="h-1/2 bg-slate-900 flex items-center justify-center text-[6rem] relative border-b border-slate-800 overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-80"></div>
                    <div class="filter drop-shadow-[0_0_20px_rgba(255,255,255,0.3)] scale-110">{{ activeScenario.emoji }}</div>
                </div>

                <div class="h-1/2 p-6 flex flex-col justify-between bg-[#0a0a0a]">
                    <div>
                        <h3 class="text-lg font-bold text-white mb-2 leading-tight font-mono">{{ activeScenario.title }}</h3>
                        <p class="text-xs text-slate-400 font-mono leading-relaxed">{{ activeScenario.desc }}</p>
                    </div>
                    <div class="flex justify-between text-[10px] font-bold font-mono uppercase pt-4 border-t border-slate-800">
                        <div class="text-[#00d2ff] w-1/2 text-left">‚Üê {{ activeScenario.left.desc }}</div>
                        <div class="text-[#ff2a6d] w-1/2 text-right">{{ activeScenario.right.desc }} ‚Üí</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 6. –ö–û–ù–ï–¶ –ò–ì–†–´ -->
        <transition name="fade">
            <div v-if="screen === 'end'" class="absolute inset-0 bg-red-950/90 z-50 flex flex-col items-center justify-center p-8 text-center backdrop-blur-md">
                <div class="text-6xl mb-4">üíÄ</div>
                <h2 class="text-4xl font-black text-white mb-2 glitch" data-text="–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –°–ë–û–ô">–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –°–ë–û–ô</h2>
                <p class="text-md text-red-200 font-mono mb-8 border border-red-500/30 bg-red-500/10 p-2 uppercase">{{ deathReason }}</p>
                
                <div class="flex gap-4 mb-8">
                     <div class="text-center bg-black/30 p-2 rounded">
                        <div class="text-[10px] text-red-300 uppercase">–•–æ–¥–æ–≤</div>
                        <div class="text-3xl font-mono font-bold">{{ moves }}</div>
                     </div>
                     <div class="text-center bg-black/30 p-2 rounded">
                        <div class="text-[10px] text-red-300 uppercase">–†–µ–∫–æ—Ä–¥</div>
                        <div class="text-3xl font-mono font-bold text-yellow-400">{{ highScore }}</div>
                     </div>
                </div>

                <button @click="screen = 'menu'" class="cyber-btn px-8 py-4 font-bold text-lg uppercase">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞</button>
            </div>
        </transition>

    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        // --- –ê–£–î–ò–û ---
        let audioCtx;
        const playSound = (type) => {
            if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if(audioCtx.state === 'suspended') audioCtx.resume();
            if(!appData.audioEnabled.value) return;

            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            const t = audioCtx.currentTime;

            if(type==='boot') { o.type='square'; o.frequency.setValueAtTime(100, t); o.frequency.linearRampToValueAtTime(800, t+0.1); g.gain.value=0.05; o.start(); o.stop(t+0.1); }
            if(type==='click') { o.type='triangle'; o.frequency.setValueAtTime(600, t); g.gain.value=0.05; g.gain.exponentialRampToValueAtTime(0.01, t+0.1); o.start(); o.stop(t+0.1); }
            if(type==='swipe') { o.type='sawtooth'; o.frequency.setValueAtTime(200, t); o.frequency.linearRampToValueAtTime(100, t+0.2); g.gain.value=0.05; o.start(); o.stop(t+0.2); }
            if(type==='death') { o.type='sawtooth'; o.frequency.setValueAtTime(100, t); o.frequency.linearRampToValueAtTime(50, t+0.5); g.gain.value=0.2; o.start(); o.stop(t+0.5); }
        };

        // --- –î–ê–ù–ù–´–ï ---
        // stats: pop (–ù–∞—Ä–æ–¥), fin (–ö–∞–∑–Ω–∞), sec (–ó–∞—â–∏—Ç–∞), mor (–ú–æ—Ä–∞–ª—å)
        const SCENARIOS = [
            { emoji:'üöã', title:'–í–ê–ì–û–ù–ï–¢–ö–ê', desc:'5 —Ä–∞–±–æ—á–∏—Ö –Ω–∞ –ø—É—Ç–∏ –∏–ª–∏ 1 –Ω–∞ –∑–∞–ø–∞—Å–Ω–æ–º?', left:{label:'1', desc:'–°–≤–µ—Ä–Ω—É—Ç—å', stats:{pop:-15, mor:10}}, right:{label:'5', desc:'–ü—Ä—è–º–æ', stats:{pop:-30, mor:-20}} },
            { emoji:'üí∞', title:'–ù–ê–õ–û–ì–ò', desc:'–ü–æ–¥–Ω—è—Ç—å –Ω–∞–ª–æ–≥–∏ —Ä–∞–¥–∏ –∞—Ä–º–∏–∏?', left:{label:'–î–ê', desc:'–ê—Ä–º–∏—è', stats:{fin:20, sec:20, pop:-25}}, right:{label:'–ù–ï–¢', desc:'–ù–∞—Ä–æ–¥', stats:{fin:-15, sec:-20, pop:15}} },
            { emoji:'ü§ñ', title:'–°–£–î–¨–Ø –ò–ò', desc:'–ó–∞–º–µ–Ω–∏—Ç—å —Å—É–¥–µ–π –Ω–∞ –∞–ª–≥–æ—Ä–∏—Ç–º—ã?', left:{label:'–ò–ò', desc:'–ß–µ—Å—Ç–Ω–æ', stats:{fin:20, mor:-10, sec:10}}, right:{label:'–õ–Æ–î–ò', desc:'–ñ–∞–ª–æ—Å—Ç—å', stats:{fin:-10, mor:10}} },
            { emoji:'ü¶†', title:'–í–ò–†–£–°', desc:'–ó–∞–∫—Ä—ã—Ç—å –≥–æ—Ä–æ–¥ –Ω–∞ –∫–∞—Ä–∞–Ω—Ç–∏–Ω?', left:{label:'–î–ê', desc:'–ñ–∏–∑–Ω—å', stats:{fin:-30, pop:-10, mor:20}}, right:{label:'–ù–ï–¢', desc:'–î–µ–Ω—å–≥–∏', stats:{fin:20, pop:-30, mor:-30}} },
            { emoji:'üïµÔ∏è', title:'–°–õ–ï–ñ–ö–ê', desc:'–¢–æ—Ç–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –≥—Ä–∞–∂–¥–∞–Ω?', left:{label:'–°–õ–ï–î–ò–¢–¨', desc:'–ë–µ–∑–æ–ø–∞—Å–Ω–æ', stats:{sec:30, pop:-25, mor:-15}}, right:{label:'–°–í–û–ë–û–î–ê', desc:'–ü—Ä–∞–≤–∞', stats:{sec:-25, pop:15, mor:10}} },
            { emoji:'üëΩ', title:'–ù–õ–û', desc:'–ü—Ä–∏—à–µ–ª—å—Ü—ã –ø—Ä–æ—Å—è—Ç –ª—é–¥–µ–π –¥–ª—è –æ–ø—ã—Ç–æ–≤.', left:{label:'–û–¢–î–ê–¢–¨', desc:'–ú–∏—Ä', stats:{fin:30, sec:20, pop:-30}}, right:{label:'–í–û–ô–ù–ê', desc:'–ß–µ—Å—Ç—å', stats:{fin:-20, sec:-30, pop:10}} },
            { emoji:'üî•', title:'–ë–£–ù–¢', desc:'–°–∂–µ—á—å –∑–∞—Ä–∞–∂–µ–Ω–Ω—ã–π —Ä–∞–π–æ–Ω?', left:{label:'–°–ñ–ï–ß–¨', desc:'–ß–∏—Å—Ç–∫–∞', stats:{pop:-40, mor:-40, sec:30}}, right:{label:'–õ–ï–ß–ò–¢–¨', desc:'–†–∏—Å–∫', stats:{fin:-30, sec:-20, mor:20}} },
            { emoji:'üåä', title:'–ü–û–¢–û–ü', desc:'–°–ø–∞—Å–∞—Ç—å –ó–∞–≤–æ–¥ –∏–ª–∏ –ñ–∏–ª—ã–µ –¥–æ–º–∞?', left:{label:'–ó–ê–í–û–î', desc:'–≠–∫–æ–Ω–æ–º–∏–∫–∞', stats:{fin:30, pop:-30}}, right:{label:'–î–û–ú–ê', desc:'–õ—é–¥–∏', stats:{fin:-30, pop:30}} },
            { emoji:'üíä', title:'–û–ü–´–¢–´', desc:'–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —è–¥—ã –Ω–∞ –∑–∞–∫–ª—é—á–µ–Ω–Ω—ã—Ö?', left:{label:'–¢–ï–°–¢', desc:'–ù–∞—É–∫–∞', stats:{sec:10, mor:-30, fin:20}}, right:{label:'–ó–ê–ü–†–ï–¢', desc:'–ü—Ä–∞–≤–∞', stats:{mor:20, fin:-10}} },
            { emoji:'üöì', title:'–ü–û–õ–ò–¶–ò–Ø', desc:'–î–∞—Ç—å –ø–æ–ª–∏—Ü–∏–∏ –∞–±—Å–æ–ª—é—Ç–Ω—É—é –≤–ª–∞—Å—Ç—å?', left:{label:'–î–ê–¢–¨', desc:'–ü–æ—Ä—è–¥–æ–∫', stats:{sec:40, pop:-30}}, right:{label:'–ù–ï–¢', desc:'–°–≤–æ–±–æ–¥–∞', stats:{sec:-20, pop:10, mor:10}} }
        ];

        const CHARS = [
            { id: 1, name: '–ù–ê–ë–õ–Æ–î–ê–¢–ï–õ–¨', icon: 'üëÅÔ∏è', desc: '–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç.', stats: {pop:50, fin:50, sec:50, mor:50}, condition: '–û—Ç–∫—Ä—ã—Ç', unlocked: true },
            { id: 2, name: '–ì–ï–ù–ï–†–ê–õ', icon: 'üéñÔ∏è', desc: '–°–∏–ª—å–Ω–∞—è –∞—Ä–º–∏—è, —Å–ª–∞–±–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞.', stats: {pop:40, fin:30, sec:80, mor:50}, condition: '–í—ã–∂–∏—Ç—å 20 —Ö–æ–¥–æ–≤', unlocked: false },
            { id: 3, name: '–ú–ê–ì–ù–ê–¢', icon: 'ü§µ', desc: '–ë–æ–≥–∞—Ç—ã–π, –Ω–æ –Ω–∞—Ä–æ–¥ –≤ —è—Ä–æ—Å—Ç–∏.', stats: {pop:20, fin:90, sec:50, mor:40}, condition: '–ù–∞–±—Ä–∞—Ç—å 100% –î–µ–Ω–µ–≥', unlocked: false },
            { id: 4, name: '–ê–ù–ê–†–•–ò–°–¢', icon: 'üí£', desc: '–í—ã –Ω–∞—á–∏–Ω–∞–µ—Ç–µ –Ω–∞ –≥—Ä–∞–Ω–∏ –∫—Ä–∞—Ö–∞.', stats: {pop:80, fin:20, sec:10, mor:80}, condition: '–£–º–µ—Ä–µ—Ç—å –æ—Ç –í—Ç–æ—Ä–∂–µ–Ω–∏—è (0% –©–∏—Ç)', unlocked: false }
        ];

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è –∞—É–¥–∏–æ
        const appData = {};

        createApp({
            setup() {
                const screen = ref('boot');
                const bootLog = ref([]);
                const bootFinished = ref(false);
                const audioEnabled = ref(false);
                
                const stats = ref({ pop: 50, fin: 50, sec: 50, mor: 50 });
                const highScore = ref(parseInt(localStorage.getItem('mos_score') || 0));
                const unlockedChars = ref(JSON.parse(localStorage.getItem('mos_chars') || '[1]'));
                
                const characters = ref(CHARS.map(c => ({...c, unlocked: unlockedChars.value.includes(c.id)})));
                const selectedChar = ref(characters.value[0]);
                
                const deck = ref([]);
                const cardIdx = ref(0);
                const moves = ref(0);
                const deathReason = ref(null);

                const isDragging = ref(false);
                const startX = ref(0);
                const currentX = ref(0);

                appData.audioEnabled = audioEnabled;

                onMounted(() => {
                    initMatrix();
                    runBoot();
                });

                const runBoot = async () => {
                    const logs = [
                        "–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –Ø–î–†–ê...",
                        "–ü–†–û–í–ï–†–ö–ê –ü–ê–ú–Ø–¢–ò... –û–ö",
                        "–ó–ê–ì–†–£–ó–ö–ê –ú–û–†–ê–õ–¨–ù–´–• –ú–û–î–£–õ–ï–ô... –û–ö",
                        "–ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –ù–ï–ô–†–û–°–ï–¢–ò... –û–ö",
                        "–°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê."
                    ];
                    for (let i = 0; i < logs.length; i++) {
                        await new Promise(r => setTimeout(r, 400));
                        const time = new Date().toLocaleTimeString('ru-RU', {hour12:false});
                        bootLog.value.push({ id: i, time, text: logs[i] });
                    }
                    bootFinished.value = true;
                };

                const finishBoot = () => {
                    audioEnabled.value = true;
                    playSound('click');
                    screen.value = 'menu';
                };

                const goToCharSelect = () => { playSound('click'); screen.value = 'char_select'; };
                const selectChar = (char) => { if(char.unlocked) { selectedChar.value = char; playSound('click'); } };
                const toggleAudio = () => { audioEnabled.value = !audioEnabled.value; if(audioEnabled.value) playSound('click'); };

                const activeScenario = computed(() => deck.value[cardIdx.value]);
                
                const cardStyle = computed(() => ({
                    transform: `translate(${currentX.value}px, ${Math.abs(currentX.value)*0.1}px) rotate(${currentX.value*0.05}deg)`,
                    transition: isDragging.value ? 'none' : 'transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)'
                }));

                const choiceOpacity = computed(() => ({
                    left: currentX.value < 0 ? Math.min(Math.abs(currentX.value)/100, 1) : 0,
                    right: currentX.value > 0 ? Math.min(currentX.value/100, 1) : 0
                }));

                const startGame = () => {
                    playSound('click');
                    stats.value = { ...selectedChar.value.stats };
                    deck.value = [...SCENARIOS, ...SCENARIOS, ...SCENARIOS].sort(()=>0.5-Math.random());
                    cardIdx.value = 0;
                    moves.value = 0;
                    deathReason.value = null;
                    currentX.value = 0;
                    screen.value = 'playing';
                };

                const checkDeath = () => {
                    const s = stats.value;
                    if(s.pop<=0) return "–í–ê–° –°–í–ï–†–ì–õ–ê –¢–û–õ–ü–ê";
                    if(s.pop>=100) return "–£–ë–ò–¢ –ü–û–í–°–¢–ê–ù–¶–ê–ú–ò";
                    if(s.fin<=0) return "–ë–ê–ù–ö–†–û–¢–°–¢–í–û –ì–û–°–£–î–ê–†–°–¢–í–ê";
                    if(s.fin>=100) return "–ö–†–ê–• –û–õ–ò–ì–ê–†–•–ò–ò";
                    if(s.sec<=0) return "–ò–ù–û–°–¢–†–ê–ù–ù–û–ï –í–¢–û–†–ñ–ï–ù–ò–ï";
                    if(s.sec>=100) return "–í–û–ï–ù–ù–´–ô –ü–ï–†–ï–í–û–†–û–¢";
                    if(s.mor<=0) return "–ü–£–ë–õ–ò–ß–ù–ê–Ø –ö–ê–ó–ù–¨";
                    if(s.mor>=100) return "–í–´ –°–í–Ø–¢–û–ô (–£–ë–†–ê–õ–ò)";
                    return null;
                };

                const unlockChar = (id) => {
                    if(!unlockedChars.value.includes(id)) {
                        unlockedChars.value.push(id);
                        localStorage.setItem('mos_chars', JSON.stringify(unlockedChars.value));
                        characters.value.find(c => c.id === id).unlocked = true;
                    }
                };

                const makeChoice = (dir) => {
                    playSound('swipe');
                    const fly = dir === 'right' ? 500 : -500;
                    currentX.value = fly;

                    const impact = activeScenario.value[dir].stats;
                    for(let k in impact) stats.value[k] = Math.min(100, Math.max(0, stats.value[k] + impact[k]));

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
                    if(moves.value >= 20) unlockChar(2); 
                    if(stats.value.fin >= 100) unlockChar(3);

                    const death = checkDeath();
                    if(death) {
                        if(stats.value.sec <= 0) unlockChar(4);
                        deathReason.value = death;
                        playSound('death');
                        if(moves.value > highScore.value) {
                            highScore.value = moves.value;
                            localStorage.setItem('mos_score', moves.value);
                        }
                        setTimeout(() => screen.value = 'end', 1500);
                    } else {
                        setTimeout(() => {
                            currentX.value = 0;
                            cardIdx.value++;
                            moves.value++;
                            if(cardIdx.value >= deck.value.length) deck.value.sort(()=>0.5-Math.random());
                        }, 300);
                    }
                };

                const startDrag = (e) => { isDragging.value = true; startX.value = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX; };
                const onMove = (e) => { if(isDragging.value) currentX.value = (e.type.includes('mouse') ? e.clientX : e.touches[0].clientX) - startX.value; };
                const onEnd = () => {
                    isDragging.value = false;
                    if(currentX.value > 100) makeChoice('right');
                    else if(currentX.value < -100) makeChoice('left');
                    else currentX.value = 0;
                };

                const getStatIcon = (k) => ({pop:'üë•', fin:'üí∞', sec:'üõ°Ô∏è', mor:'‚öñÔ∏è'}[k]);
                const getBarColor = (k, v) => {
                    if (v < 15 || v > 85) return 'bg-red-500 shadow-[0_0_15px_red]';
                    return {pop:'bg-blue-400', fin:'bg-yellow-400', sec:'bg-green-400', mor:'bg-purple-400'}[k];
                };

                onMounted(() => {
                    window.addEventListener('mousemove', onMove); window.addEventListener('touchmove', onMove);
                    window.addEventListener('mouseup', onEnd); window.addEventListener('touchend', onEnd);
                });

                return { 
                    screen, bootLog, bootFinished, stats, activeScenario, cardStyle, choiceOpacity,
                    characters, selectedChar, highScore, moves, deathReason, audioEnabled,
                    finishBoot, goToCharSelect, selectChar, startGame, toggleAudio, startDrag,
                    getStatIcon, getBarColor
                };
            }
        }).mount('#app');

        // --- –ú–ê–¢–†–ò–¶–ê –§–û–ù ---
        function initMatrix() {
            const c = document.getElementById('matrix'); const ctx = c.getContext('2d');
            c.width = window.innerWidth; c.height = window.innerHeight;
            const drops = Array(Math.floor(c.width/20)).fill(1);
            function draw() {
                ctx.fillStyle = 'rgba(0,0,0,0.05)'; ctx.fillRect(0,0,c.width,c.height);
                ctx.fillStyle = '#0F0'; ctx.font = '15px monospace';
                for(let i=0; i<drops.length; i++) {
                    ctx.fillText(String.fromCharCode(0x0400+Math.random()*255), i*20, drops[i]*20); // –ö–∏—Ä–∏–ª–ª–∏—Ü–∞ –≤ –º–∞—Ç—Ä–∏—Ü–µ
                    if(drops[i]*20 > c.height && Math.random()>0.975) drops[i] = 0;
                    drops[i]++;
                }
                requestAnimationFrame(draw);
            }
            draw();
        }
    </script>
</body>
</html>